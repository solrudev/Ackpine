{"config":{"separator":"[\\s\\-_,:!=\\[\\]()\\\\\"`/]+|\\.(?!\\d)"},"items":[{"location":"","level":1,"title":"Overview","text":"<p>Ackpine - Android Coroutines-friendly Kotlin-first Package Installer extensions</p> <p>A library providing consistent APIs for installing and uninstalling apps on an Android device.</p> <p>Key features of Ackpine:</p> <ul> <li>Ease of use: Ackpine reduces complexity of dealing with system <code>PackageInstaller</code> APIs.</li> <li>Unifying of different system APIs: Ackpine provides an ability to choose system package installer API which will be used to install/uninstall a package.</li> <li>Built-in split APKs support: Ackpine provides simple lazy sequences-based APIs for reading, parsing and filtering split APKs.</li> <li>Persistent: Ackpine persists every session so it can properly handle process death.</li> <li>Deferred: Ackpine allows to defer user's intervention via customizable high-priority notification.</li> <li>Progress and state updates: it's easy to observe every session's state and progress updates.</li> <li>Advanced features: Ackpine allows to benefit from advanced features without juggling complex OS APIs (such as install pre-approval) introduced in later Android versions.</li> <li>Shizuku: Shizuku is supported as an installer backend with advanced install flags.</li> <li>100% Java and Kotlin-friendly: while maintaining full Java compatibility, Ackpine was developed as a Kotlin-first library.</li> <li>Compatibility: Ackpine supports Android versions starting from API level 16.</li> </ul>","path":["Overview"],"tags":[]},{"location":"#download","level":2,"title":"Download","text":"<p>Ackpine is available on <code>mavenCentral()</code>.</p> <p>Ackpine depends on Jetpack libraries, so it's also necessary to add the <code>google()</code> Maven repository.</p> Gradle version catalogbuild.gradle.kts <pre><code>[versions]\nackpine = \"0.20.4\"\n\n[libraries]\nackpine-core = { module = \"ru.solrudev.ackpine:ackpine-core\", version.ref = \"ackpine\" }\n\n# optional - Kotlin extensions and Coroutines support\nackpine-ktx = { module = \"ru.solrudev.ackpine:ackpine-ktx\", version.ref = \"ackpine\" }\n\n# optional - utilities for working with split APKs\nackpine-splits = { module = \"ru.solrudev.ackpine:ackpine-splits\", version.ref = \"ackpine\" }\n\n# optional - Kotlin extensions and Coroutines support for ackpine-splits\nackpine-splits-ktx = { module = \"ru.solrudev.ackpine:ackpine-splits-ktx\", version.ref = \"ackpine\" }\n\n# optional - support for asset files inside of application's package\nackpine-assets = { module = \"ru.solrudev.ackpine:ackpine-assets\", version.ref = \"ackpine\" }\n\n# optional - plugin enabling installs/uninstalls through Shizuku\nackpine-shizuku = { module = \"ru.solrudev.ackpine:ackpine-shizuku\", version.ref = \"ackpine\" }\n\n# optional - Kotlin extensions for Shizuku plugin\nackpine-shizuku-ktx = { module = \"ru.solrudev.ackpine:ackpine-shizuku-ktx\", version.ref = \"ackpine\" }\n\n# optional - testing utilities\nackpine-test = { module = \"ru.solrudev.ackpine:ackpine-test\", version.ref = \"ackpine\" }\n\n[bundles]\nackpine = [\n    \"ackpine-core\",\n    \"ackpine-ktx\",\n    \"ackpine-splits\",\n    \"ackpine-splits-ktx\",\n    \"ackpine-assets\",\n    \"ackpine-shizuku\",\n    \"ackpine-shizuku-ktx\"\n]\n</code></pre> <pre><code>dependencies {\n    val ackpineVersion = \"0.20.4\"\n    implementation(\"ru.solrudev.ackpine:ackpine-core:$ackpineVersion\")\n\n    // optional - Kotlin extensions and Coroutines support\n    implementation(\"ru.solrudev.ackpine:ackpine-ktx:$ackpineVersion\")\n\n    // optional - utilities for working with split APKs\n    implementation(\"ru.solrudev.ackpine:ackpine-splits:$ackpineVersion\")\n\n    // optional - Kotlin extensions and Coroutines support for ackpine-splits\n    implementation(\"ru.solrudev.ackpine:ackpine-splits-ktx:$ackpineVersion\")\n\n    // optional - support for asset files inside of application's package\n    implementation(\"ru.solrudev.ackpine:ackpine-assets:$ackpineVersion\")\n\n    // optional - plugin enabling installs/uninstalls through Shizuku\n    implementation(\"ru.solrudev.ackpine:ackpine-shizuku:$ackpineVersion\")\n\n    // optional - Kotlin extensions for Shizuku plugin\n    implementation(\"ru.solrudev.ackpine:ackpine-shizuku-ktx:$ackpineVersion\")\n\n    // optional - testing utilities\n    testImplementation(\"ru.solrudev.ackpine:ackpine-test:$ackpineVersion\")\n}\n</code></pre>","path":["Overview"],"tags":[]},{"location":"#license","level":2,"title":"License","text":"<pre><code>Copyright (C) 2023-2026 Ilya Fomichev\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n</code></pre>","path":["Overview"],"tags":[]},{"location":"architecture/","level":1,"title":"Architecture","text":"<p>Ackpine library has a concept of <code>Session</code>. <code>Session</code> manages the flow of installation or uninstallation process.</p> <p>One can launch multiple different sessions at once, but can't create them directly. To create a session, one needs to use <code>PackageInstaller</code> or <code>PackageUninstaller</code>.</p> <p>In essence, <code>PackageInstaller</code> is a repository of <code>ProgressSessions</code>, and <code>PackageUninstaller</code> is a repository of <code>Sessions</code>. They track and persist every session launched.</p>","path":["Architecture"],"tags":[]},{"location":"architecture/#session-state-machine","level":2,"title":"Session state machine","text":"<p><code>Session</code> is a finite-state machine which transitions from one <code>State</code> to another. For transitions to happen, client code needs to react to state changes and call the appropriate methods on the session.</p> <pre><code>stateDiagram-v2\n    [*] --&gt; Pending\n    Pending --&gt; Active : launch()\n    Active --&gt; Active : launch() — re-entry\n    Active --&gt; Awaiting : preparation completes\n    Awaiting --&gt; Committed : commit()\n    Committed --&gt; Committed : commit() — re-entry\n    Committed --&gt; Succeeded : session succeeds\n    Committed --&gt; Failed : session fails\n\n    Pending --&gt; Cancelled : cancel()\n    Active --&gt; Cancelled : cancel()\n    Awaiting --&gt; Cancelled : cancel()\n    Committed --&gt; Cancelled : cancel()\n\n    Succeeded --&gt; [*]\n    Failed --&gt; [*]\n    Cancelled --&gt; [*]</code></pre> State Terminal Description Pending No Session has been created but not launched yet. Active No Session is being actively prepared (copying files, requesting preapproval, etc.). Awaiting No Preparation is complete; session is waiting for <code>commit()</code>. Committed No Session is committed; user confirmation is in progress. Succeeded Yes Installation or uninstallation completed successfully. Failed Yes Session completed with an error. Carries a typed <code>Failure</code> object. Cancelled Yes Session was cancelled by the client via <code>cancel()</code>.","path":["Architecture"],"tags":[]},{"location":"architecture/#what-triggers-each-transition","level":3,"title":"What triggers each transition","text":"<ul> <li>Pending → Active: calling <code>launch()</code>.</li> <li>Active → Awaiting: session finishes its internal preparation (file copying, preapproval request, etc.).</li> <li>Awaiting → Committed: calling <code>commit()</code>, which triggers user confirmation if needed.</li> <li>Committed → Succeeded / Failed: the system delivers the installation/uninstallation result.</li> <li>Any non-terminal → Cancelled: calling <code>cancel()</code>.</li> </ul>","path":["Architecture"],"tags":[]},{"location":"architecture/#re-entrancy-for-process-death-resilience","level":3,"title":"Re-entrancy for process death resilience","text":"<p>Session by itself is passive — it doesn't do anything until client code says so. This is done to make sessions persistable and suspendable. If any step while the session is active is interrupted (e.g. by process death), it can be re-executed later:</p> <ul> <li>Active → Active: if the preparation process was interrupted, calling <code>launch()</code> again re-starts it.</li> <li>Committed → Committed: if the confirmation was interrupted, calling <code>commit()</code> again re-requests it.</li> </ul> <p>The library saves session state to a database, so sessions survive process death. After restart, you re-retrieve the session by its ID and re-attach listeners. See Handling process death for an example.</p>","path":["Architecture"],"tags":[]},{"location":"architecture/#automating-the-state-machine","level":3,"title":"Automating the state machine","text":"<p>The library provides ready-to-use implementations that automate the full session lifecycle:</p> <ul> <li><code>Session.TerminalStateListener.bind()</code> (Java) — automatically calls <code>launch()</code> and <code>commit()</code> at the right moments and delivers the terminal result via callbacks.</li> <li><code>Session.await()</code> (Kotlin, from <code>ackpine-ktx</code>) — a suspending function that drives the session to a terminal state and returns the result.</li> </ul> <p>See Getting Started for usage examples.</p>","path":["Architecture"],"tags":[]},{"location":"architecture/#module-dependency-graph","level":2,"title":"Module dependency graph","text":"<pre><code>graph TD\n    ackpine-api --&gt; ackpine-resources\n    ackpine-core --&gt; ackpine-api\n    ackpine-ktx --&gt; ackpine-api\n    ackpine-test --&gt; ackpine-api\n    ackpine-shizuku --&gt; ackpine-core\n    ackpine-shizuku-ktx --&gt; ackpine-shizuku\n    ackpine-shizuku-ktx --&gt; ackpine-ktx\n    ackpine-splits-ktx --&gt; ackpine-splits\n    ackpine-assets</code></pre> Artifact Provides Depends on <code>ackpine-api</code> Core API contracts: <code>Session</code>, <code>PackageInstaller</code>, <code>PackageUninstaller</code>, parameters, plugin interfaces <code>ackpine-resources</code> <code>ackpine-core</code> Runtime implementation of all API contracts; database persistence <code>ackpine-api</code> <code>ackpine-ktx</code> Kotlin DSL for session parameters; <code>Session.await()</code> coroutine extension <code>ackpine-api</code> <code>ackpine-splits</code> Split APK utilities: <code>ZippedApkSplits</code>, <code>Apk</code>, <code>SplitPackage</code> Standalone <code>ackpine-splits-ktx</code> Kotlin coroutine extensions for <code>ackpine-splits</code> <code>ackpine-splits</code> <code>ackpine-assets</code> <code>ContentProvider</code> for reading APKs from app's asset files Standalone <code>ackpine-shizuku</code> Shizuku-backed <code>PackageInstallerService</code> plugin <code>ackpine-core</code> <code>ackpine-shizuku-ktx</code> Kotlin DSL for Shizuku plugin configuration <code>ackpine-shizuku</code>, <code>ackpine-ktx</code> <code>ackpine-test</code> Test doubles: <code>TestPackageInstaller</code>, <code>TestPackageUninstaller</code>, scripted sessions <code>ackpine-api</code> <code>ackpine-resources</code> Abstractions for persistable Android resources: <code>ResolvableString</code> — <p>Note</p> <p><code>ackpine-ktx</code> and <code>ackpine-test</code> depend only on <code>ackpine-api</code>, not on <code>ackpine-core</code>. This means coroutine extensions and test doubles work without pulling in the full runtime.</p>","path":["Architecture"],"tags":[]},{"location":"architecture/#plugin-system","level":2,"title":"Plugin system","text":"<p>Ackpine has a plugin system that allows extending session behavior without coupling <code>ackpine-core</code> to concrete plugin implementations.</p>","path":["Architecture"],"tags":[]},{"location":"architecture/#consumer-facing-api","level":3,"title":"Consumer-facing API","text":"<ul> <li><code>AckpinePlugin</code> — interface that plugins implement. Each plugin has a unique string <code>id</code> and typed <code>Parameters</code>.</li> <li><code>AckpinePluginRegistry</code> — interface exposed by parameter builders (<code>InstallParameters.Builder</code>, <code>UninstallParameters.Builder</code>). Call <code>usePlugin(pluginClass, parameters)</code> to apply a plugin to a session.</li> </ul>","path":["Architecture"],"tags":[]},{"location":"architecture/#build-time-parameter-modification","level":3,"title":"Build-time parameter modification","text":"<p>Plugins can modify session parameters at build-time. When <code>InstallParameters.Builder.build()</code> or <code>UninstallParameters.Builder.build()</code> is called, each registered plugin's <code>apply(builder)</code> method is invoked on the builder before the parameters object is constructed. This lets plugins enforce constraints — for example, the Shizuku plugin forces session-based installer type and disables preapproval.</p>","path":["Architecture"],"tags":[]},{"location":"architecture/#services","level":3,"title":"Services","text":"<p>Plugins provide runtime services by implementing the <code>AckpineService</code> and <code>AckpineServiceProvider</code> interfaces (internal to <code>ackpine-core</code>). <code>AckpineService</code> defines the service's capabilities (e.g. wrapping Android's <code>PackageInstaller</code> behavior), while <code>AckpineServiceProvider</code> acts as a factory that exposes available service instances. Each provider declares a set of plugin identifiers (<code>pluginIdentifiers</code>) that tie it back to the <code>AckpinePlugin</code> implementations it serves — this is how <code>ackpine-core</code> maps a registered plugin to its service provider without depending on the concrete plugin module.</p>","path":["Architecture"],"tags":[]},{"location":"architecture/#parameters-persistence","level":3,"title":"Parameters persistence","text":"<p>Plugins can have their own parameters for a session. Each <code>AckpineServiceProvider</code> supplies <code>PluginParametersStore</code> instances responsible for persisting and restoring plugin parameters. Plugins implement parameters persistence separately from the main database of <code>ackpine-core</code>, so that plugins can maintain independent data persistence schemas and migrations, while also being decoupled from the concrete persistence mechanism.</p>","path":["Architecture"],"tags":[]},{"location":"architecture/#runtime-discovery","level":3,"title":"Runtime discovery","text":"<p>Plugin service implementations are discovered at runtime via Java <code>ServiceLoader</code> (SPI). Each plugin module declares an <code>AckpineServiceProvider</code> in <code>META-INF/services/</code>. When the first session initializes, it discovers all providers on the classpath and loads their services lazily.</p> <p>This design means:</p> <ul> <li><code>ackpine-core</code> never depends on concrete plugin modules — plugins are loaded dynamically.</li> <li>Plugin parameters are persisted alongside session data, so sessions with plugins survive process death.</li> <li>Adding a plugin to your app is as simple as adding the dependency and calling <code>usePlugin()</code> in your parameters.</li> </ul>","path":["Architecture"],"tags":[]},{"location":"architecture/#instantiation-and-proguard","level":3,"title":"Instantiation and ProGuard","text":"<p>Plugin instances are created reflectively via no-arg constructors and cached as singletons in <code>AckpinePluginCache</code>. Because of this, plugin class names are persisted (they are stored as part of session parameters), and plugins must have a no-arg constructor available at runtime. Consumer ProGuard rules for <code>ackpine-api</code> keep all <code>AckpinePlugin</code> implementations, preventing class renaming or constructor removal that would break reflection.</p> <p>See the Shizuku page for the currently available plugin and Configuration for usage in parameters.</p>","path":["Architecture"],"tags":[]},{"location":"architecture/#design-decisions","level":2,"title":"Design decisions","text":"","path":["Architecture"],"tags":[]},{"location":"architecture/#uri-as-sole-apk-input-type","level":3,"title":"<code>Uri</code> as sole APK input type","text":"<p><code>Uri</code> is chosen as the sole input type of APKs. It makes them persistable and allows to plug in any APK source via <code>ContentProvider</code>. The library leverages this in <code>ackpine-splits</code> and <code>ackpine-assets</code> modules to read APKs from zipped files and app's asset files respectively.</p>","path":["Architecture"],"tags":[]},{"location":"architecture/#session-passivity","level":3,"title":"Session passivity","text":"<p>Sessions are deliberately passive — they don't advance their own state. This design makes sessions persistable and suspendable. The tradeoff is that client code must drive transitions (or use the provided <code>TerminalStateListener</code> / <code>await()</code> helpers). This approach ensures that sessions can be interrupted by process death at any point and seamlessly resumed later.</p>","path":["Architecture"],"tags":[]},{"location":"architecture/#resolvablestring-and-drawableid-persistence","level":3,"title":"<code>ResolvableString</code> and <code>DrawableId</code> persistence","text":"<p><code>ResolvableString</code> and <code>DrawableId</code> values are persisted to a Room database, which creates a problem with Android resource IDs.</p> <p>Android resource IDs (<code>R.string.*</code>, <code>R.drawable.*</code>) are generated integers that can change across builds. If a raw ID were stored, it might point to the wrong resource after an app update. To solve this, <code>ResolvableString.Resource</code> is abstract — consumers subclass it and override <code>stringId()</code> to return the <code>R.string.*</code> constant at call time. The serialized BLOB stores the object, and upon deserialization <code>stringId()</code> re-reads the current ID from the <code>R</code> class, keeping the mapping up-to-date. The same applies to <code>DrawableId</code>.</p> <p>Because Java Object Serialization is used, subclasses need <code>serialVersionUID</code> for forward-compatible deserialization, and singletons need <code>readResolve()</code> to preserve identity. For strings that are never persisted (e.g. error messages in a ViewModel), <code>ResolvableString.transientResource()</code> stores the integer ID directly, avoiding the need for a custom subclass.</p> <p>See notifications configuration section for full code examples.</p>","path":["Architecture"],"tags":[]},{"location":"building/","level":1,"title":"Building","text":"","path":["Building"],"tags":[]},{"location":"building/#gradle-setup","level":2,"title":"Gradle setup","text":"<p>Root <code>Ackpine</code> project has the following Gradle tasks:</p> <ul> <li><code>:buildAckpine</code>: a lifecycle task which builds release AARs of all Ackpine library projects;</li> <li><code>:buildSamples</code>: a lifecycle task which builds and gathers release versions of all Ackpine sample app APKs and R8 mappings into <code>release</code> directory;</li> <li><code>:releaseChangelog</code>: an actionable task which extracts changelog for the last release from <code>docs/changelog.md</code> file to <code>changelog.txt</code>;</li> <li><code>:checkAckpineAbi</code>: validates public ABI surface of the library projects against dumps;</li> <li><code>:updateAckpineAbi</code>: dumps public ABI surface of the library projects.</li> </ul> <p>Tests:</p> <ul> <li><code>test</code>: runs unit tests for all projects where they are configured;</li> <li><code>api&lt;ApiLevel&gt;DebugAndroidTest</code>: runs device tests on Gradle managed device with <code>ApiLevel</code> for all projects where they are configured and if they have <code>api&lt;ApiLevel&gt;</code> managed device registered.</li> </ul> <p>Other useful tasks provided by third-party Gradle plugins:</p> <ul> <li><code>:api-documentation:dokkaGenerate</code>: generates API documentation for the library projects and places it into <code>docs/api</code> directory;</li> <li><code>publishAndReleaseToMavenCentral</code>: publishes the library projects to Maven Central repository. For further information see plugin's documentation.</li> </ul> <p>Projects are added to <code>:buildAckpine</code>, <code>:buildSamples</code>, <code>:checkAckpineAbi</code> and <code>:updateAckpineAbi</code> tasks through <code>dependencies</code> block in root <code>build.gradle.kts</code>. Library project should have <code>ru.solrudev.ackpine.library</code> Gradle plugin applied, and sample app project should have <code>ru.solrudev.ackpine.app-release</code> Gradle plugin applied.</p> <p>Projects are added to <code>:api-documentation:dokkaGenerate</code> task through <code>dependencies</code> block in <code>build.gradle.kts</code> of <code>api-documentation</code> project. Documented project should have <code>ru.solrudev.ackpine.dokka</code> Gradle plugin applied.</p>","path":["Building"],"tags":[]},{"location":"building/#documentation-website","level":2,"title":"Documentation website","text":"<p>To serve documentation website on localhost, execute this command (requires Python 3 and Zensical to be installed): <pre><code>zensical serve\n</code></pre></p>","path":["Building"],"tags":[]},{"location":"building/#sample-apps","level":2,"title":"Sample apps","text":"<p>To build release versions of sample apps you'll need to provide a keystore. For this, create a <code>keystore.properties</code> file in the root directory with the following contents: <pre><code>APP_SIGNING_KEY_ALIAS=YOUR_KEY_ALIAS\nAPP_SIGNING_KEY_PASSWORD=YOUR_KEY_PASSWORD\nAPP_SIGNING_KEY_STORE_PASSWORD=YOUR_KEYSTORE_PASSWORD\nAPP_SIGNING_KEY_STORE_PATH=PATH_TO_YOUR_KEYSTORE_FILE\n</code></pre> The other way to provide these values is through environment variables. <code>keystore.properties</code> file takes precedence over environment variables.</p>","path":["Building"],"tags":[]},{"location":"changelog/","level":1,"title":"Change Log","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#version-0204-2026-03-01","level":2,"title":"Version 0.20.4 (2026-03-01)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Enforce <code>INTENT_BASED</code> uninstaller type on API &lt; 21 when configuring uninstall parameters.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-0203-2026-02-28","level":2,"title":"Version 0.20.3 (2026-02-28)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_1","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Fix race leading to possibly lost callbacks for <code>TerminalStateListener.bind()</code> with concurrent usage.</li> <li>Don't notify with stale state/progress events after listener is removed from a session.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-0202-2026-02-22","level":2,"title":"Version 0.20.2 (2026-02-22)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_2","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Make state transitions in sessions atomic, improving thread-safety.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-0201-2026-02-20","level":2,"title":"Version 0.20.1 (2026-02-20)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_3","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Align test sessions' behavior with real implementations better: don't notify with the same progress events next to each other, return <code>false</code> on <code>TestSession</code>'s <code>launch()</code> and <code>commit()</code> subsequent calls.</li> <li>Implement <code>equals()</code> and <code>hashCode()</code> in <code>TestSessionScript</code>.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-0200-2026-02-12","level":2,"title":"Version 0.20.0 (2026-02-12)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_4","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Fix <code>TestPackageUninstaller.clearSessions()</code> not clearing <code>sessions</code>.</li> <li>Fix <code>NoClassDefFoundError</code> when calling <code>PackageInstaller.getInstance()</code> and <code>PackageUninstaller.getInstance()</code> in tests with <code>ackpine-test</code>.</li> <li>Add <code>removeSession()</code> to <code>TestPackageInstaller</code> and <code>TestPackageUninstaller</code>.</li> <li>Add <code>createdParameters</code> to <code>TestPackageInstaller</code> and <code>TestPackageUninstaller</code>.</li> <li>Expose <code>val script: TestSessionScript</code> in <code>TestSessionController</code>.</li> <li>Make a copy of <code>TestSessionScript</code> for each created session if default session factory is used. This makes multi-session tests with <code>auto</code> script viable.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#public-api-changes","level":3,"title":"Public API changes","text":"<ul> <li><code>uninstallerType</code> property setter was made private in <code>UninstallParameters.Builder</code>.</li> <li>Added <code>removeSession()</code> to <code>TestPackageInstaller</code> and <code>TestPackageUninstaller</code>.</li> <li>Added <code>createdParameters</code> property to <code>TestPackageInstaller</code> and <code>TestPackageUninstaller</code>.</li> <li><code>TestPackageInstaller</code> and <code>TestPackageUninstaller</code> were made non-final.</li> <li><code>TestSessionController</code> was made non-final.</li> <li><code>script</code> property of <code>TestSessionController</code> was made public.</li> <li>Added <code>TestProgressSessionController</code> in <code>ackpine-test</code>. Now <code>TestProgressSession.controller</code> returns <code>TestProgressSessionController</code>.</li> <li>Deprecated <code>TestSessionController.setProgress()</code> with error. This method will be removed in the next minor release. This may be source-incompatible if you were calling <code>setProgress()</code> on uninstall session controllers in tests (which anyway would have caused runtime exceptions).</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-0195-2026-02-12","level":2,"title":"Version 0.19.5 (2026-02-12)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_5","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Fix strings created with <code>ResolvableString.transientResource()</code> resolving incorrectly.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-0194-2026-02-07","level":2,"title":"Version 0.19.4 (2026-02-07)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_6","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Fix introduced in 0.19.3 repeated uninstall confirmation on some devices.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-0193-2026-02-04","level":2,"title":"Version 0.19.3 (2026-02-04)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_7","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Fix uninstall activities not handling stops and process death correctly on API &gt;= 29.</li> <li>Fix incorrectly applied <code>isAppNotForegroundRequired</code> install constraint instead of <code>isAppNotInteractingRequired</code> for session-based installer.</li> <li>Fix <code>StackOverflowError</code> when an error occurs while reading APK for intent-based installer sessions on API &lt; 24.</li> <li>Make confirmation activities transparent in display cutout areas.</li> <li>Add an overload for <code>TestProgressSession</code> constructor with default script in <code>ackpine-test</code>.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#public-api-changes_1","level":3,"title":"Public API changes","text":"<ul> <li>Added a no-arg constructor to <code>TestProgressSession</code>.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-0192-2026-01-11","level":2,"title":"Version 0.19.2 (2026-01-11)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_8","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Add <code>ackpine-test</code> module with testing utilities for Ackpine. See Testing documentation page for more information.</li> <li><code>ResolvableString.transientResource()</code> no longer creates anonymous classes. Now these strings properly implement <code>hashCode()</code> and <code>equals()</code>.</li> <li>Add unit tests to <code>sample-java</code> and <code>sample-ktx</code> using <code>ackpine-test</code>.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#public-api-changes_2","level":3,"title":"Public API changes","text":"<ul> <li>Added new <code>ackpine-test</code> module.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-0191-2026-01-03","level":2,"title":"Version 0.19.1 (2026-01-03)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_9","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Hotfix: uninstall session crash when using Shizuku on Android 8.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-0190-2026-01-03","level":2,"title":"Version 0.19.0 (2026-01-03)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_10","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Fix uninstall session crash when using Shizuku on Android &lt; 8.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#public-api-changes_3","level":3,"title":"Public API changes","text":"<ul> <li>Removed <code>UninstallFailure.Generic.INSTANCE</code> static field.</li> <li>Deprecated with error setter for <code>uninstallerType</code> property in <code>UninstallParameters.Builder</code>. Use <code>setUninstallerType()</code> method. The setter will be made private in the next minor release.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-0186-2025-12-29","level":2,"title":"Version 0.18.6 (2025-12-29)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_11","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Fix install session fail on Android &lt; 9 when using <code>installerPackageName</code> with Shizuku plugin.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-0185-2025-12-26","level":2,"title":"Version 0.18.5 (2025-12-26)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#dependencies","level":3,"title":"Dependencies","text":"<ul> <li>Updated <code>apksig</code> to 8.13.2.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_12","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Fix intent-based uninstall sessions hanging and not showing confirmation screen.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-0184-2025-12-16","level":2,"title":"Version 0.18.4 (2025-12-16)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_13","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Add support for changing installer package name when using Shizuku.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#public-api-changes_4","level":3,"title":"Public API changes","text":"<ul> <li>Add <code>installerPackageName</code> property to <code>ShizukuPlugin.Parameters</code> and related APIs.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-0183-2025-12-15","level":2,"title":"Version 0.18.3 (2025-12-15)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_14","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Throw <code>IllegalStateException</code> instead of <code>IllegalArgumentException</code> where more appropriate.</li> <li>Remove <code>AckpinePlugin.Parameters</code> from ProGuard rules.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#public-api-changes_5","level":3,"title":"Public API changes","text":"<ul> <li><code>SplitPackagesNotSupportedException</code> is now extending <code>IllegalStateException</code> instead of <code>IllegalArgumentException</code>.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-0182-2025-12-09","level":2,"title":"Version 0.18.2 (2025-12-09)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_15","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Add a slight delay before aborting a <code>PackageInstaller</code>-based uninstall session if failure event from OS wasn't received.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-0181-2025-12-04","level":2,"title":"Version 0.18.1 (2025-12-04)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_16","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Prioritize system <code>PackageInstaller</code> event for <code>PackageInstaller</code>-based uninstall failures. Now, if proper failure event is received from the OS, there won't be a generic <code>Aborted by user</code> failure message.</li> <li>Show uninstall failure message toast in sample apps.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-0180-2025-12-03","level":2,"title":"Version 0.18.0 (2025-12-03)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_17","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Add support for Android's <code>PackageInstaller</code>-backed uninstallation. Make it the default implementation on API level &gt;= 21.</li> <li>Allow to configure uninstall implementation via <code>UninstallerType</code> enum. See documentation for details.</li> <li>Introduce new <code>UninstallFailure</code> types which map to system's <code>PackageInstaller</code> uninstall status.</li> <li>Add plugins support for uninstall sessions.</li> <li>Implement Shizuku support for uninstall sessions via <code>ShizukuUninstallPlugin</code>. See documentation for details.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#public-api-changes_6","level":3,"title":"Public API changes","text":"<ul> <li>Added <code>AckpinePluginRegistry</code> interface, which is implemented by <code>InstallParameters.Builder</code> and <code>UninstallParameters.Builder</code>.</li> <li>Added <code>usePlugin()</code> functions to <code>UninstallParameters.Builder</code>.</li> <li>Added <code>UninstallerType</code> enum and related APIs.</li> <li>Added <code>pluginContainer</code> property to <code>UninstallParameters</code>.</li> <li>Added <code>UninstallFailure.Blocked</code>, <code>UninstallFailure.Conflict</code> classes.</li> <li>Source-incompatible: <code>UninstallFailure.Generic</code> is now a data class. Referencing to it as a singleton object is no longer possible in Kotlin. Static <code>INSTANCE</code> field is deprecated and will be removed in the next minor release.</li> <li><code>UninstallFailure</code> is now a sealed class with abstract <code>message</code> property, similar to <code>InstallFailure</code>.</li> <li>Added some DSL APIs related to plugins in <code>ackpine-ktx</code>.</li> <li>Removed <code>usePlugin()</code> inline extension function for <code>InstallParametersDsl</code> in <code>ackpine-ktx</code>.</li> <li>Added <code>ShizukuUninstallPlugin</code> and related APIs in <code>ackpine-shizuku</code> and <code>ackpine-shizuku-ktx</code>.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-0170-2025-11-25","level":2,"title":"Version 0.17.0 (2025-11-25)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#dependencies_1","level":3,"title":"Dependencies","text":"<ul> <li>Updated <code>apksig</code> to 8.13.1.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_18","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Fix grammar in <code>Session</code> documentation.</li> <li>Remove deprecated APIs. In particular, use <code>InstallParameters.pluginContainer</code> instead of the removed <code>InstallParameters.plugins</code>.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#public-api-changes_7","level":3,"title":"Public API changes","text":"<ul> <li>Removed <code>InstallParameters.plugins</code> property.</li> <li>Removed hidden <code>copy</code> method from <code>InstallMode</code>.</li> <li>Removed hidden <code>copy</code> method from <code>Apk.Libs</code>, <code>Apk.ScreenDensity</code> and <code>Apk.Localization</code> in <code>ackpine-splits</code>.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-0161-2025-10-07","level":2,"title":"Version 0.16.1 (2025-10-07)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_19","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Add Vietnamese language for default library messages and for sample apps. Thanks to @nqmgaming.</li> <li>Rewrite last Ackpine internal database migration introduced in 0.16.0. If you didn't update to 0.16.0, only sessions with plugins applied (such as <code>ShizukuPlugin</code>) will be cleared after update to 0.16.1.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-0160-2025-10-01","level":2,"title":"Version 0.16.0 (2025-10-01)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#dependencies_2","level":3,"title":"Dependencies","text":"<ul> <li>Updated <code>apksig</code> to 8.12.3.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_20","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Reimplement Ackpine plugin parameters persistence. Note that this changes internal Ackpine database schema, so all previous sessions will be cleared after update to this Ackpine version.</li> <li>Move all file operations in intent-based install sessions to worker thread.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#public-api-changes_8","level":3,"title":"Public API changes","text":"<ul> <li><code>AckpinePlugin.Parameters</code> and <code>AckpinePlugin.Parameters.None</code> no longer implement <code>java.io.Serializable</code>.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-0153-2025-08-21","level":2,"title":"Version 0.15.3 (2025-08-21)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_21","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Hotfix: add ProGuard rules for Ackpine Compress.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-0152-2025-08-21","level":2,"title":"Version 0.15.2 (2025-08-21)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#dependencies_3","level":3,"title":"Dependencies","text":"<ul> <li>Updated Apache Commons IO to 2.20.0 (<code>ackpine-compress-android</code>).</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_22","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Pull changes from Apache Commons Compress 1.28.0 to Ackpine Compress fork.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-0151-2025-08-13","level":2,"title":"Version 0.15.1 (2025-08-13)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_23","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Improve error handling in install sessions.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-0150-2025-08-07","level":2,"title":"Version 0.15.0 (2025-08-07)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#dependencies_4","level":3,"title":"Dependencies","text":"<ul> <li>Updated <code>androidx.concurrent</code> to 1.3.0.</li> <li>Updated <code>apksig</code> to 8.12.0.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_24","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Add <code>fallbackToOnDemandApproval</code> parameter for pre-approvals. See documentation for details.</li> <li>Raise <code>InstallParameters.plugins</code> deprecation level to error.</li> <li>Improvements for file picking in sample apps.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#public-api-changes_9","level":3,"title":"Public API changes","text":"<ul> <li>Added <code>fallbackToOnDemandApproval</code> property to <code>InstallPreapproval</code>, <code>InstallPreapproval.Builder</code> and <code>InstallPreapprovalDsl</code>.</li> <li>Raised deprecation level to error for <code>InstallParameters.plugins</code> property.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-0140-2025-06-27","level":2,"title":"Version 0.14.0 (2025-06-27)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_25","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Rename <code>InstallParameters.plugins</code> to <code>InstallParameters.pluginContainer</code>.</li> <li>Use direct calls instead of reflection in Shizuku plugin.</li> <li>Make all Android resources private in <code>ackpine-runtime</code> module.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#public-api-changes_10","level":3,"title":"Public API changes","text":"<ul> <li>Added <code>InstallParameters.pluginContainer</code> property.</li> <li>Deprecated with warning <code>InstallParameters.plugins</code> property.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-0132-2025-06-10","level":2,"title":"Version 0.13.2 (2025-06-10)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_26","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Prevent crashing the whole app on main thread if Shizuku is used when Shizuku service dies, instead only complete an install session with exception.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-0131-2025-06-05","level":2,"title":"Version 0.13.1 (2025-06-05)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_27","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Add static <code>DEFAULT</code> field to <code>ShizukuPlugin</code> parameters.</li> <li>Make all Android resources private in <code>ackpine-core</code> module.</li> <li>Remove <code>UPDATE_PACKAGES_WITHOUT_USER_ACTION</code> and <code>ENFORCE_UPDATE_OWNERSHIP</code> permissions from sample apps.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#public-api-changes_11","level":3,"title":"Public API changes","text":"<ul> <li>Added static <code>DEFAULT</code> field to <code>ShizukuPlugin.Parameters</code>.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-0130-2025-06-02","level":2,"title":"Version 0.13.0 (2025-06-02)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#dependencies_5","level":3,"title":"Dependencies","text":"<ul> <li>Updated <code>apksig</code> to 8.10.1.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_28","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Add ability to use Shizuku for install sessions via <code>ShizukuPlugin</code> in <code>ackpine-shizuku</code> artifact. See documentation for details.</li> <li><code>ackpine-splits</code>: Don't fall back to <code>ZipInputStream</code> if reading of zipped file fails and throw instead.</li> <li>Sample apps: don't restart installation if app was launched through an <code>ACTION_VIEW</code> intent when launching from recent apps history.</li> <li>Sample apps: fix reappearing install session when last install session is removed.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#public-api-changes_12","level":3,"title":"Public API changes","text":"<ul> <li>Added <code>AckpinePlugin</code>, <code>AckpinePlugin.Parameters</code>, <code>AckpinePluginContainer</code> types in <code>ackpine-api</code>.</li> <li>Added <code>usePlugin</code> function to <code>InstallParameters.Builder</code>, <code>InstallParametersDsl</code>.</li> <li>Added <code>plugins</code> property to <code>InstallParameters</code>.</li> <li>Added <code>ackpine-shizuku</code> and <code>ackpine-shizuku-ktx</code> modules.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-0122-2025-05-20","level":2,"title":"Version 0.12.2 (2025-05-20)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#dependencies_6","level":3,"title":"Dependencies","text":"<ul> <li>Updated Kotlin to 2.1.21.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_29","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Prevent confirmation notifications from automatic grouping to avoid user clicking on the group, leaving sessions in hanging state.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-0121-2025-05-16","level":2,"title":"Version 0.12.1 (2025-05-16)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#dependencies_7","level":3,"title":"Dependencies","text":"<ul> <li><code>ackpine-splits</code> now depends on <code>ackpine-compress-android</code> instead of Apache Commons Compress.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_30","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Random access reading of zipped APK splits is now supported on API &lt; 26 without <code>READ_EXTERNAL_STORAGE</code> permission (#83).</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-0120-2025-05-05","level":2,"title":"Version 0.12.0 (2025-05-05)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#dependencies_8","level":3,"title":"Dependencies","text":"<ul> <li>Updated <code>apksig</code> to 8.9.2.</li> <li>Updated <code>kotlinx.coroutines</code> to 1.10.2.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#public-api-changes_13","level":3,"title":"Public API changes","text":"<ul> <li>Removed deprecated APIs from <code>ackpine-splits</code>.</li> <li>Moved <code>AckpineReinitializeException</code> from <code>ackpine-api</code> to <code>ackpine-core</code>.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-0112-2025-04-19","level":2,"title":"Version 0.11.2 (2025-04-19)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#dependencies_9","level":3,"title":"Dependencies","text":"<ul> <li>Extracted <code>ackpine-api</code> artifact, which is now depended upon by <code>ackpine-core</code> and <code>ackpine-ktx</code>.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_31","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Extract <code>ackpine-api</code> artifact. If you had a dependency on <code>ackpine-ktx</code>, but didn't have an explicit dependency on <code>ackpine-core</code>, you have to add it. No API changes were introduced.</li> <li>Fix NPE causing <code>Unable to start receiver ru.solrudev.ackpine.impl.installer.receiver.PackageInstallerStatusReceiver</code> when self-updating if Ackpine version was &lt; <code>0.11.0</code> (#106).</li> <li>Fix listeners added through <code>TerminalStateListener.Binder</code> not invoking if session was already in terminal state.</li> <li>Make status bar and navigation bar fully transparent on all Android versions for session confirmation dialog Activity.</li> <li>Allow to configure install constraints timeout with <code>java.time.Duration</code>.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#public-api-changes_14","level":3,"title":"Public API changes","text":"<ul> <li>Added <code>InstallConstraints.Builder</code> constructor overload accepting <code>java.time.Duration</code>.</li> <li>Added <code>InstallConstraints.gentleUpdate()</code> static method overloads accepting <code>java.time.Duration</code>.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-0111-2025-04-06","level":2,"title":"Version 0.11.1 (2025-04-06)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#dependencies_10","level":3,"title":"Dependencies","text":"<ul> <li>Updated Kotlin to 2.1.20.</li> <li>Updated <code>apksig</code> to 8.9.1.</li> <li>Updated <code>kotlinx.coroutines</code> to 1.10.1.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_32","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Add builder-like API for attaching <code>TerminalStateListener</code> to a session instead of subclassing it. Refer to updated documentation for usage example.</li> <li>Fix documentation for deprecated <code>ackpine-splits</code> APIs.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#public-api-changes_15","level":3,"title":"Public API changes","text":"<ul> <li>Added <code>Session.TerminalStateListener.bind()</code> static method.</li> <li>Added <code>Session.TerminalStateListener.Binder</code> class, <code>Session.TerminalStateListener.OnSuccessListener</code>, <code>Session.TerminalStateListener.OnFailureListener</code>, <code>Session.TerminalStateListener.OnCancelListener</code> functional interfaces.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-0110-2025-03-04","level":2,"title":"Version 0.11.0 (2025-03-04)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#dependencies_11","level":3,"title":"Dependencies","text":"<ul> <li>Updated Kotlin to 2.1.10.</li> <li>Updated <code>apksig</code> to 8.8.2.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_33","level":3,"title":"Bug fixes and improvements","text":"<ul> <li> <p>Mark <code>ListenableFuture</code> result types as covariant in public API. This change is source-incompatible for Java consumers:</p> <pre><code>// Using Guava\nvar future = packageInstaller.getSessionAsync(id);\nFutures.addCallback(future, new FutureCallback&lt;ProgressSession&lt;InstallFailure&gt;&gt;() {\n//            Add explicit type here if absent ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n// ...    \n}, MoreExecutors.directExecutor());\n</code></pre> </li> <li> <p>Fix <code>SESSION_BASED</code> installer sessions not committing after process restart on API level 31-32 if <code>requireUserAction</code> is <code>false</code> and user's confirmation for this session was already requested previously nevertheless.</p> </li> <li>Add overloads accepting icon for <code>preapproval</code> <code>InstallParameters</code> DSL in <code>ackpine-ktx</code>.</li> <li>Mark <code>requireUserAction</code> setters as delicate API, as this option is unstable for use on different Android versions. Check documentation for more details.</li> <li>Raise <code>ackpine-splits</code> APIs deprecation level to error.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#public-api-changes_16","level":3,"title":"Public API changes","text":"<ul> <li>Marked <code>ListenableFuture</code> result types as covariant in <code>PackageInstaller</code> and <code>PackageUninstaller</code>.</li> <li>Raised deprecation level to error for <code>ApkSplits.throwOnInvalidSplitPackage()</code>, <code>ApkSplits.sortedByCompatibility()</code>, <code>ApkSplits.filterCompatible()</code>, <code>ApkSplits.addAllTo()</code> methods and <code>ApkCompatibility</code> class in <code>ackpine-splits</code>.</li> <li>Marked <code>requireUserAction</code> setter in <code>InstallParametersDsl</code> and <code>InstallParameters.Builder.setRequireUserAction()</code> as delicate APIs.</li> <li>Added <code>InstallParametersDsl.preapproval()</code> overloads accepting <code>Uri</code> of an icon.</li> <li>Added <code>InstallPreapproval</code> factory function overloads accepting <code>Uri</code> of an icon.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-0102-2025-02-09","level":2,"title":"Version 0.10.2 (2025-02-09)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_34","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Fix <code>SessionBasedInstallConfirmationActivity was finished by user</code> failure after granting permission and confirming installation on some devices with Android 12-13 (#108).</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-0101-2025-01-29","level":2,"title":"Version 0.10.1 (2025-01-29)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_35","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Fix a corner case when simultaneously pressing system Back button and Install while confirming installation may result in install session's failure (#104).</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#public-api-changes_17","level":3,"title":"Public API changes","text":"<ul> <li>Deprecated with warning <code>ApkCompatibility</code> class in <code>ackpine-splits</code>.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-0100-2025-01-24","level":2,"title":"Version 0.10.0 (2025-01-24)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#dependencies_12","level":3,"title":"Dependencies","text":"<ul> <li>Updated Gradle wrapper to 8.12.</li> <li>Updated Android Gradle Plugin to 8.8.0.</li> <li>Updated <code>apksig</code> to 8.8.0.</li> <li>Updated ViewBindingPropertyDelegate to 2.0.0 (sample apps dependency).</li> <li>Added <code>api</code> dependency on Guava's <code>ListenableFuture</code> in <code>ackpine-splits</code>.</li> <li>Added <code>implementation</code> dependency on <code>androidx.concurrent:concurrent-futures</code> in <code>ackpine-splits</code> and <code>ackpine-runtime</code>.</li> <li>Changed <code>ackpine-splits</code> dependency to <code>ackpine-splits-ktx</code> in <code>sample-ktx</code>.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_36","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Repeat displaying confirmation notification if it was dismissed on Android 14+ when session's confirmation is set to <code>DEFERRED</code>.</li> <li>Introduce <code>SplitPackage</code> API in <code>ackpine-splits</code>.</li> <li>Deprecate some APIs for <code>Apk</code> sequences in <code>ackpine-splits</code>. Migrate to <code>SplitPackage</code> API.</li> <li>Rename <code>ApkSplits.throwOnInvalidSplitPackage()</code> to <code>ApkSplits.validate()</code> in <code>ackpine-splits</code>.</li> <li>Add support for cancellation in <code>Apk.fromUri()</code> in <code>ackpine-splits</code>.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#public-api-changes_18","level":3,"title":"Public API changes","text":"<ul> <li>Added <code>SplitPackage</code> and related APIs in <code>ackpine-splits</code>.</li> <li>Added <code>ackpine-splits-ktx</code> module.</li> <li>Added <code>Apk.fromUri()</code> overload accepting <code>CancellationSignal</code> in <code>ackpine-splits</code>.</li> <li>Added <code>ApkSplits.validate()</code> in <code>ackpine-splits</code>.</li> <li>Exposed <code>CloseableSequence</code> interface in <code>ackpine-splits</code>.</li> <li>Deprecated with warning <code>ApkSplits.throwOnInvalidSplitPackage()</code>, <code>ApkSplits.sortedByCompatibility()</code>, <code>ApkSplits.filterCompatible()</code> and <code>ApkSplits.addAllTo()</code> methods in <code>ackpine-splits</code>.</li> <li>Changed return type of <code>ZippedApkSplits.getApksForFile()</code> and <code>ZippedApkSplits.getApksForUri()</code> to <code>CloseableSequence&lt;Apk&gt;</code> in <code>ackpine-splits</code>.</li> <li>Removed deprecated <code>SessionResult</code> and <code>Session.await()</code> overload in <code>ackpine-ktx</code>.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-094-2025-01-04","level":2,"title":"Version 0.9.4 (2025-01-04)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_37","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Correct error handling when closing I/O resources.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-093-2024-12-25","level":2,"title":"Version 0.9.3 (2024-12-25)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#dependencies_13","level":3,"title":"Dependencies","text":"<ul> <li>Updated KSP to 2.0.21-1.0.28.</li> <li>Updated Android Gradle Plugin to 8.7.3.</li> <li>Updated <code>apksig</code> to 8.7.3.</li> <li>Updated <code>binary-compatibility-validator</code> to 0.17.0.</li> <li>Updated <code>androidx.navigation</code> to 2.8.5 (sample apps dependency).</li> <li>Updated Guava to 33.4.0-android (sample apps dependency).</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_38","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Raise <code>compileSdk</code> to 35.</li> <li>Use random access when parsing APK on API level 26+ in <code>Apk.fromUri()</code>. This greatly improves performance for large APKs.</li> <li>Add <code>ZippedFileProvider.getUriForZipEntry()</code> overloads for <code>File</code> and <code>Uri</code>.</li> <li>Raise <code>targetSdk</code> for sample apps to 35.</li> <li>Proper support for edge-to-edge display in sample apps.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#public-api-changes_19","level":3,"title":"Public API changes","text":"<ul> <li>Added <code>getUriForZipEntry(File, String)</code> and <code>getUriForZipEntry(Uri, String)</code> to <code>ZippedFileProvider.Companion</code> and as static <code>ZippedFileProvider</code> methods.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-092-2024-12-19","level":2,"title":"Version 0.9.2 (2024-12-19)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_39","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Fix <code>SESSION_BASED</code> installer session completing with \"Install permission denied\" failure when performing a self-update if install permission was not granted because it was unnecessary.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-091-2024-12-14","level":2,"title":"Version 0.9.1 (2024-12-14)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_40","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Proper support of dynamic features for split APKs (#95).</li> <li>Add documentation for <code>Apk</code> properties.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#public-api-changes_20","level":3,"title":"Public API changes","text":"<ul> <li>Added <code>Apk.ConfigSplit</code> sealed interface in <code>ackpine-splits</code> module.</li> <li>Added <code>configForSplit</code> property to <code>Apk.Libs</code>, <code>Apk.ScreenDensity</code> and <code>Apk.Localization</code> in <code>ackpine-splits</code> module.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-090-2024-12-07","level":2,"title":"Version 0.9.0 (2024-12-07)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#dependencies_14","level":3,"title":"Dependencies","text":"<ul> <li>Updated Dokka to 2.0.0-Beta.</li> <li>Updated Gradle wrapper to 8.11.1.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_41","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Introduce <code>InstallPreapproval</code> API. See documentation on usage.</li> <li>Introduce <code>InstallConstraints</code> API. See documentation on usage.</li> <li>Add <code>requestUpdateOwnership</code> option for install sessions. Permission <code>ENFORCE_UPDATE_OWNERSHIP</code> was added to <code>AndroidManifest.xml</code>.</li> <li>Add <code>packageSource</code> option for install sessions.</li> <li> <p>Add <code>dontKillApp</code> option for install sessions with <code>InheritExisting</code> install mode.</p> </li> <li> <p>Source-incompatible: deprecate <code>SessionResult</code> and return <code>Session.State.Completed</code> from <code>Session.await()</code>.</p> <p><code>SessionResult</code> was an early design leftover which was mistakenly overlooked. Now it's finally been dealt with.</p> <p>To migrate, change <code>SessionResult.Success</code> to <code>Session.State.Succeeded</code>, and <code>SessionResult.Error</code> to <code>Session.State.Failed</code>. <code>cause</code> property of <code>SessionResult.Error</code> is replaced with <code>failure</code> property of <code>Session.State.Failed</code>.</p> <pre><code>// Old\nwhen (val result = session.await()) {\n    is SessionResult.Success -&gt; println(\"Success\")\n    is SessionResult.Error -&gt; println(result.cause.message)\n}\n\n// New\nwhen (val result = session.await()) {\n    Session.State.Succeeded -&gt; println(\"Success\")\n    is Session.State.Failed -&gt; println(result.failure.message)\n}\n</code></pre> </li> <li> <p>Source-incompatible: <code>when</code> matches on <code>InstallFailure</code> and <code>UninstallFailure</code> type are no longer exhaustive.</p> <p>This change was made to guard against possible additions of failure types in future Android versions, like <code>Timeout</code> in Android 14.</p> </li> <li> <p>Fix session not launching after process restart if it was in the midst of preparations.</p> </li> <li>Show notification for <code>SESSION_BASED</code> install sessions when <code>DEFERRED</code> confirmation is set only if user action is actually required.</li> <li>Fix possible races when <code>ListenableFutures</code> returned from <code>getSessionsAsync()</code> and <code>getActiveSessionsAsync()</code> might not get completed.</li> <li>Lower API level required for <code>READ_EXTERNAL_STORAGE</code> permission in sample apps.</li> <li>Add <code>sample-api34</code> sample project.</li> <li>Add \"Building\" section to documentation.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#public-api-changes_21","level":3,"title":"Public API changes","text":"<ul> <li>Source-incompatible: <code>Session.await()</code> now returns <code>Session.State.Completed</code>. Overload returning <code>SessionResult</code> is left for binary compatibility, but will be removed in the next minor version.</li> <li>Source-incompatible: <code>when</code> matches on <code>InstallFailure</code> and <code>UninstallFailure</code> type are no longer exhaustive.</li> <li>Deprecated: <code>SessionResult</code> is deprecated and will be removed in the next minor version.</li> <li>Added <code>InstallPreapproval</code> class and related APIs to <code>InstallParameters</code>, <code>InstallParameters.Builder</code> and <code>InstallParametersDsl</code>.</li> <li>Added <code>InstallConstraints</code> class and related APIs to <code>InstallParameters</code>, <code>InstallParameters.Builder</code> and <code>InstallParametersDsl</code>.</li> <li>Added <code>dontKillApp</code> boolean property to <code>InstallMode.InheritExisting</code>.</li> <li>Added <code>requestUpdateOwnership</code> property to <code>InstallParameters</code>, <code>InstallParameters.Builder</code> and <code>InstallParametersDsl</code>.</li> <li>Added <code>PackageSource</code> class and related APIs to <code>InstallParameters</code>, <code>InstallParameters.Builder</code> and <code>InstallParametersDsl</code>.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-083-2024-11-07","level":2,"title":"Version 0.8.3 (2024-11-07)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_42","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Return <code>Aborted</code> failure when <code>INTENT_BASED</code> install session is cancelled.</li> <li>Return <code>Aborted</code> failure when uninstall via <code>ACTION_UNINSTALL_PACKAGE</code> is cancelled.</li> <li>Request permissions if they're not granted when sample apps are launched via <code>ACTION_VIEW</code> intent.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-082-2024-11-01","level":2,"title":"Version 0.8.2 (2024-11-01)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_43","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Fix introduced in 0.8.1 repeated install confirmation after granting install permission if confirmation was dismissed by clicking outside of confirmation dialog on some OS versions.</li> <li>Don't use <code>requireUserAction</code> option in samples as it's unstable with different vendors and OS versions.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-081-2024-10-31","level":2,"title":"Version 0.8.1 (2024-10-31)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#dependencies_15","level":3,"title":"Dependencies","text":"<ul> <li>Updated Kotlin to 2.0.21.</li> <li>Updated <code>androidx.annotation</code> to 1.9.1.</li> <li>Updated <code>androidx.activity</code> to 1.9.3 (sample apps dependency).</li> <li>Updated <code>androidx.constraintlayout</code> to 2.2.0 (sample apps dependency).</li> <li>Updated <code>androidx.lifecycle</code> to 2.8.7 (sample apps dependency).</li> <li>Updated <code>androidx.navigation</code> to 2.8.3 (sample apps dependency).</li> <li>Updated Guava to 33.3.1-android (sample apps dependency).</li> <li>Migrated from <code>gradle-nexus/publish-plugin</code> to <code>vanniktech/gradle-maven-publish-plugin</code> for publishing artifacts to Maven Central.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_44","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Fix install confirmation from OS not displaying after granting install permission on some devices (particularly Android TV) using <code>SESSION_BASED</code> installer. This is a fix for #84.</li> <li>Fix various issues with dismissing install confirmation from OS via clicking outside of confirmation dialog using <code>SESSION_BASED</code> installer.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-080-2024-10-25","level":2,"title":"Version 0.8.0 (2024-10-25)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#dependencies_16","level":3,"title":"Dependencies","text":"<ul> <li>Extracted <code>ackpine-resources</code> artifact, which is now depended upon by <code>ackpine-core</code>.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_45","level":3,"title":"Bug fixes and improvements","text":"<ul> <li> <p><code>NotificationString</code> is superseded by <code>ResolvableString</code> to accommodate stable string resources resolution. <code>ResolvableString</code> is now located in <code>ackpine-resources</code> artifact and can also be used separately for general app needs. <code>NotificationString</code> is deprecated and will be removed in next minor release.</p> <p>To migrate <code>NotificationString.resource()</code> usages to <code>ResolvableString</code>, create classes inheriting from <code>ResolvableString.Resource</code> like this: <pre><code>// Old\nNotificationString.resource(R.string.install_message, fileName)\n\n// New\nclass InstallMessage(fileName: String) : ResolvableString.Resource(fileName) {\n    override fun stringId() = R.string.install_message\n    private companion object {\n        private const val serialVersionUID = 4749568844072243110L\n    }\n}\n\nInstallMessage(fileName)\n</code></pre></p> <p>Note that this requires to purge internal database because of incompatible changes, so all previous sessions will be cleared when Ackpine is updated to 0.8.0.</p> </li> <li> <p><code>NotificationData</code> now requires an instance of <code>DrawableId</code> class instead of integer drawable resource ID for icon to accommodate stable drawable resources resolution.</p> </li> <li>Don't hardcode a condition in implementation of <code>SESSION_BASED</code> sessions when Android's <code>PackageInstaller.Session</code> fails without report. It should possibly improve reliability on different devices.</li> <li>Fix progress bars on install screen not using latest value in sample apps.</li> <li>Disable cancel button when session's state is Committed in sample apps.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#public-api-changes_22","level":3,"title":"Public API changes","text":"<ul> <li>Breaking: <code>NotificationData</code>, <code>NotificationData.Builder</code> and <code>NotificationDataDsl</code> now require <code>ResolvableString</code> instead of <code>NotificationString</code> as <code>title</code> and <code>contentText</code> type. <code>NotificationString</code> is deprecated with an error deprecation level and will be removed in next minor release.</li> <li>Breaking: <code>NotificationData</code>, <code>NotificationData.Builder</code> and <code>NotificationDataDsl</code> now require <code>DrawableId</code> instead of integer as <code>icon</code> type.</li> <li>Added <code>ResolvableString</code> sealed interface in <code>ackpine-resources</code> module.</li> <li>Added <code>DrawableId</code> interface in <code>ackpine-core</code> module.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-076-2024-10-12","level":2,"title":"Version 0.7.6 (2024-10-12)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#dependencies_17","level":3,"title":"Dependencies","text":"<ul> <li>Reverted <code>androidx.startup</code> to 1.1.1.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_46","level":3,"title":"Bug fixes and improvements","text":"<ul> <li><code>INTENT_BASED</code> package installer sessions are no longer stuck in <code>COMMITTED</code> state if they have performed a successful app self-update (not in all scenarios). This is an (almost) fix for issue #33.</li> <li>Use <code>ZipFile</code> API for reading <code>AndroidManifest.xml</code> when possible while parsing single APK with <code>Apk.fromFile()</code> and <code>Apk.fromUri()</code>.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-075-2024-10-06","level":2,"title":"Version 0.7.5 (2024-10-06)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_47","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Improve thread-safety of <code>Session</code>, <code>PackageInstaller</code> and <code>PackageUninstaller</code> implementations.</li> <li>Fix progress changing without animation when session is committed in sample apps.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-074-2024-10-04","level":2,"title":"Version 0.7.4 (2024-10-04)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#dependencies_18","level":3,"title":"Dependencies","text":"<ul> <li>Added direct dependency on <code>androidx.coordinatorlayout:coordinatorlayout:1.2.0</code> to sample projects.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_48","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Improve error handling in <code>ackpine-splits</code>. This also allowed to avoid duplicate <code>Apk</code> objects in sequences returned from <code>ZippedApkSplits</code> factories in some possible cases of errors.</li> <li>Fix incorrect sessions' progress when there are list items beyond visible area in sample apps.</li> <li>Hide floating Install button when scrolling down in sample apps.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-073-2024-10-01","level":2,"title":"Version 0.7.3 (2024-10-01)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_49","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Fix resources not closing when throwing if <code>throwOnInvalidSplitPackage()</code> is applied and <code>ZippedApkSplits.getApksForUri()</code> delegates to <code>ZippedApkSplits.getApksForFile()</code>.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-072-2024-09-30","level":2,"title":"Version 0.7.2 (2024-09-30)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#dependencies_19","level":3,"title":"Dependencies","text":"<ul> <li>Updated Kotlin to 2.0.20.</li> <li>Updated Gradle wrapper to 8.9.</li> <li>Updated Android Gradle Plugin to 8.6.1.</li> <li>Updated Apache Commons Compress to 1.27.1.</li> <li>Updated <code>apksig</code> to 8.6.1.</li> <li>Updated <code>binary-compatibility-validator</code> to 0.16.3.</li> <li>Updated <code>foojay-resolver-convention</code> to 0.8.0.</li> <li>Updated <code>kotlinx.coroutines</code> to 1.9.0.</li> <li>Updated <code>androidx.startup</code> to 1.2.0.</li> <li>Updated <code>androidx.annotation</code> to 1.8.2.</li> <li>Updated <code>androidx.activity</code> to 1.9.2 (sample apps dependency).</li> <li>Updated <code>androidx.lifecycle</code> to 2.8.6 (sample apps dependency).</li> <li>Updated <code>androidx.navigation</code> to 2.8.1 (sample apps dependency).</li> <li>Updated Guava to 33.3.0-android (sample apps dependency).</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_50","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Make split APKs sequences created with <code>ZippedApkSplits</code> factories cooperate with <code>throwOnInvalidSplitPackage()</code> operation. They will now close held resources when split package validation fails if not consumed in whole. Now the recommended order of applying <code>throwOnInvalidSplitPackage()</code> is immediately after creating a sequence.</li> <li>Improve documentation about split APKs.</li> <li>Fix some visual bugs with sessions' progress in sample apps.</li> <li>Disable cancel button when install session is committed in sample apps.</li> <li>Cancel sessions when ViewModel is cleared in Java sample app.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-071-2024-07-03","level":2,"title":"Version 0.7.1 (2024-07-03)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_51","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Fix <code>ConcurrentModificationException</code> in <code>Session</code> in very rare cases (#70).</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-070-2024-07-02","level":2,"title":"Version 0.7.0 (2024-07-02)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#dependencies_20","level":3,"title":"Dependencies","text":"<ul> <li>Updated Android Gradle Plugin to 8.5.0.</li> <li>Updated <code>apksig</code> to 8.5.0.</li> <li>Updated <code>androidx.concurrent</code> to 1.2.0.</li> <li>Updated <code>androidx.lifecycle</code> to 2.8.3 (sample apps dependency).</li> <li>Updated Guava to 33.2.1-android (sample apps dependency).</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_52","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Fix race conditions leading to <code>SQLiteConstraintException: FOREIGN KEY constraint failed</code> (#68).</li> <li>Fix sessions getting stuck after launching when there's a lot of them created concurrently.</li> <li>Fix <code>FileNotFoundException</code> and <code>ZipException</code> when reading zipped files in some cases.</li> <li>Add support for external storage <code>Uri</code>s when trying to directly access files.</li> <li>Log APK parsing exceptions in sample apps.</li> <li>Open file picker immediately after granting all permissions in sample apps.</li> <li>Remove <code>MANAGE_EXTERNAL_STORAGE</code> permission from sample apps.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#public-api-changes_23","level":3,"title":"Public API changes","text":"<ul> <li><code>InstallMode.Companion</code> is made private.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-061-2024-06-11","level":2,"title":"Version 0.6.1 (2024-06-11)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#dependencies_21","level":3,"title":"Dependencies","text":"<ul> <li>Updated Kotlin to 2.0.0.</li> <li>Updated Gradle wrapper to 8.8.</li> <li>Updated Android Gradle Plugin to 8.4.2.</li> <li>Updated Apache Commons Compress to 1.26.2.</li> <li>Updated <code>apksig</code> to 8.4.2.</li> <li>Updated <code>kotlinx.coroutines</code> to 1.8.1.</li> <li>Updated <code>androidx.lifecycle</code> to 2.8.1 (sample apps dependency).</li> <li>Updated <code>androidx.appcompat</code> to 1.7.0 (sample apps dependency).</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_53","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Introduce an API for deleting previously created Ackpine's notification channel.</li> <li>Add info about notification channel initialization to documentation.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#public-api-changes_24","level":3,"title":"Public API changes","text":"<ul> <li>Added <code>Ackpine.deleteNotificationChannel()</code> static method in <code>ackpine-core</code> module.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-060-2024-05-20","level":2,"title":"Version 0.6.0 (2024-05-20)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#dependencies_22","level":3,"title":"Dependencies","text":"<ul> <li>Updated Kotlin to 1.9.24.</li> <li>Updated <code>androidx.annotation</code> to 1.8.0.</li> <li>Updated <code>androidx.activity</code> to 1.9.0 (sample apps dependency).</li> <li>Updated Guava to 33.2.0-android (sample apps dependency).</li> <li>Updated Material Components to 1.12.0 (sample apps dependency).</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_54","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Introduce an install mode option for <code>InstallParameters</code>.</li> <li>More consistent behavior of <code>COMMITTED</code> session state notifications when installer app is privileged for silent installs.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#public-api-changes_25","level":3,"title":"Public API changes","text":"<ul> <li>Added <code>InstallMode</code> sealed interface with two children (<code>Full</code> and <code>InheritExisting</code>) in <code>ackpine-core</code> module.</li> <li>Added <code>installMode</code> property to <code>InstallParameters</code> and its builder in <code>ackpine-core</code> module.</li> <li>Added <code>installMode</code> property to <code>InstallParametersDsl</code> in <code>ackpine-ktx</code> module.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-055-2024-04-29","level":2,"title":"Version 0.5.5 (2024-04-29)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_55","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Fix some internal state of <code>SESSION_BASED</code> package installer session when it's in terminal state and is being initialized on retrieval from <code>PackageInstaller</code>.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-054-2024-04-26","level":2,"title":"Version 0.5.4 (2024-04-26)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_56","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Fix <code>SESSION_BASED</code> package installer session not notifying about transitioning into <code>Committed</code> state when installation is performed without user's action via setting <code>requireUserAction</code> to <code>false</code>.</li> <li>Fix <code>SESSION_BASED</code> package installer session not updating its progress if it's already prepared and app process is restarted.</li> <li>Don't allow to commit <code>SESSION_BASED</code> package installer session after app process restart when an actual installation process in the system is ongoing.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-053-2024-04-25","level":2,"title":"Version 0.5.3 (2024-04-25)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#dependencies_23","level":3,"title":"Dependencies","text":"<ul> <li>Updated Android Gradle Plugin to 8.3.2.</li> <li>Updated <code>apksig</code> to 8.3.2.</li> <li>Added Apache Commons Compress dependency to <code>ackpine-splits</code> module.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_57","level":3,"title":"Bug fixes and improvements","text":"<ul> <li><code>ackpine-splits</code>: use <code>FileChannel</code> to read zipped APKs on Android Oreo+ if possible. This drastically improves performance when direct access through <code>java.io</code> APIs is not available and allows to process problematic ZIP files (such as XAPK files).</li> <li>Don't crash if exception occurs while iterating APK sequence in sample apps, and display the exception message instead.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-052-2024-03-30","level":2,"title":"Version 0.5.2 (2024-03-30)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#dependencies_24","level":3,"title":"Dependencies","text":"<ul> <li>Updated Kotlin to 1.9.23.</li> <li>Updated Gradle wrapper to 8.7.</li> <li>Updated Android Gradle Plugin to 8.3.1.</li> <li>Updated <code>apksig</code> to 8.3.1.</li> <li>Updated Dokka to 1.9.20.</li> <li>Updated Guava to 33.1.0-android (sample apps dependency).</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_58","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Allow to commit <code>SESSION_BASED</code> package installer sessions from background when using <code>requireUserAction = false</code> and <code>Confirmation.IMMEDIATE</code>.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-051-2024-02-23","level":2,"title":"Version 0.5.1 (2024-02-23)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#dependencies_25","level":3,"title":"Dependencies","text":"<ul> <li>Updated Gradle wrapper to 8.6.</li> <li>Updated Android Gradle Plugin to 8.2.2.</li> <li>Updated <code>apksig</code> to 8.2.2.</li> <li>Updated <code>kotlinx.coroutines</code> to 1.8.0.</li> <li>Updated <code>binary-compatibility-validator</code> to 0.14.0 .</li> <li>Updated <code>androidx.navigation</code> to 2.7.7 (sample apps dependency).</li> <li>Updated Guava to 33.0.0-android (sample apps dependency).</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_59","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Fix possibility of sessions' notification ID inconsistencies.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-050-2024-02-02","level":2,"title":"Version 0.5.0 (2024-02-02)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_60","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Add support for timeout install failure introduced in API level 34.</li> <li>Add new <code>sortedByCompatibility()</code> and related APIs in <code>ackpine-splits</code> module.</li> <li>Fix documentation for <code>NotificationData</code> and related APIs.</li> <li>Don't create session object if it already exists when initializing all sessions.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#public-api-changes_26","level":3,"title":"Public API changes","text":"<ul> <li>Source-incompatible, possibly throwing in runtime: added <code>Timeout</code> child to sealed <code>InstallFailure</code> class in <code>ackpine-core</code> module.</li> <li>Added <code>ApkCompatibility</code> class in <code>ackpine-splits</code> module.</li> <li>Added extension functions for <code>Sequence&lt;Apk&gt;</code>, <code>Sequence&lt;ApkCompatibility&gt;</code>, <code>Iterable&lt;Apk&gt;</code>, <code>Iterable&lt;ApkCompatibility&gt;</code> to <code>ApkSplits</code> in <code>ackpine-splits</code> module: <code>sortedByCompatibility()</code>, <code>filterCompatible()</code>, <code>addAllTo()</code>.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-044-2024-01-22","level":2,"title":"Version 0.4.4 (2024-01-22)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_61","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Prevent clients from committing a <code>SESSION_BASED</code> package installer session while it's initializing if it's already completed.</li> <li>Fix an exception when app process is restarted after returning from package uninstall confirmation.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-043-2024-01-19","level":2,"title":"Version 0.4.3 (2024-01-19)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#dependencies_26","level":3,"title":"Dependencies","text":"<ul> <li>Updated Kotlin to 1.9.22.</li> <li>Updated Android Gradle Plugin to 8.2.1.</li> <li>Updated <code>apksig</code> to 8.2.1.</li> <li>Updated <code>androidx.annotation</code> to 1.7.1.</li> <li>Updated <code>androidx.activity</code> to 1.8.2 (sample apps dependency).</li> <li>Updated <code>androidx.lifecycle</code> to 2.7.0 (sample apps dependency).</li> <li>Updated <code>androidx.navigation</code> to 2.7.6 (sample apps dependency).</li> <li>Updated Material Components to 1.11.0 (sample apps dependency).</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_62","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Fix incorrect <code>Succeeded</code> state of <code>SESSION_BASED</code> package installer session in some cases if app is killed while installing but system installer Activity remains visible.</li> <li>Scale Ackpine thread pool size depending on available CPU cores.</li> <li>Associate APK, APKS, APKM and XAPK files with Ackpine sample app.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-042-2024-01-15","level":2,"title":"Version 0.4.2 (2024-01-15)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_63","level":3,"title":"Bug fixes and improvements","text":"<ul> <li><code>PackageInstaller</code> and <code>PackageUninstaller</code> no longer throw exceptions when trying to get a session of wrong type (install session from <code>PackageUninstaller</code> and vice versa).</li> <li><code>PackageInstaller</code> and <code>PackageUninstaller</code> no longer throw exceptions when getting a list of sessions if there were both install and uninstall sessions in internal database.</li> <li>Add ProGuard rules and <code>serialVersionUID</code> for classes which are <code>Serializable</code> for more stable serialization. Note that this requires to purge internal database because of incompatible changes, so all previous sessions will be cleared when Ackpine is updated to 0.4.2.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-041-2024-01-06","level":2,"title":"Version 0.4.1 (2024-01-06)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_64","level":3,"title":"Bug fixes and improvements","text":"<ul> <li><code>SESSION_BASED</code> package installer sessions are no longer stuck in <code>COMMITTED</code> state if they have performed a successful app self-update. This is a partial fix for issue #33.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-040-2023-12-11","level":2,"title":"Version 0.4.0 (2023-12-11)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_65","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Improve documentation for <code>Session.launch()</code> and <code>Session.commit()</code> and make them return a boolean to indicate whether their invocation took effect.</li> <li>Add <code>isCompleted</code> and <code>isCancelled</code> boolean properties to <code>Session</code>.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#public-api-changes_27","level":3,"title":"Public API changes","text":"<ul> <li>Breaking: <code>Session.DefaultStateListener</code> is renamed to <code>Session.TerminalStateListener</code>.</li> <li>Breaking: <code>Session.State.isCompleted</code> is removed.</li> <li>Possibly breaking: <code>isCompleted</code> and <code>isCancelled</code> boolean properties are added to <code>Session</code>.</li> <li>Possibly breaking: <code>Session.launch()</code> and <code>Session.commit()</code> now return <code>Boolean</code>.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-032-2023-12-01","level":2,"title":"Version 0.3.2 (2023-12-01)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#dependencies_27","level":3,"title":"Dependencies","text":"<ul> <li>Updated Kotlin to 1.9.21.</li> <li>Updated Gradle wrapper to 8.5.</li> <li>Updated Android Gradle Plugin to 8.2.0.</li> <li>Updated <code>apksig</code> to 8.2.0.</li> <li>Updated <code>androidx.room</code> to 2.6.1.</li> <li>Updated <code>androidx.activity</code> to 1.8.1 (sample apps dependency).</li> <li>Updated Guava to 32.1.3-android (sample apps dependency).</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_66","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Add Afrikaans translations for South Africa. Thanks to @MJJacobs01!</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-031-2023-11-10","level":2,"title":"Version 0.3.1 (2023-11-10)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_67","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Don't throw from install parameters builder constructor which accepts <code>Iterable</code>, from <code>add()</code> and <code>addAll()</code> methods on API levels &lt; 21 if only a single APK ends up in <code>ApkList</code>. This fixes a long-lasting issue of throwing when getting a session from <code>PackageInstaller</code> after process restart on API levels &lt; 21.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-030-2023-11-09","level":2,"title":"Version 0.3.0 (2023-11-09)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#dependencies_28","level":3,"title":"Dependencies","text":"<ul> <li>Extracted <code>ackpine-runtime</code> artifact, which is now depended upon by <code>ackpine-core</code> and <code>ackpine-splits</code>. <code>ackpine-splits</code> now doesn't declare a transitive dependency on <code>ackpine-core</code>.</li> <li><code>ackpine-ktx</code> now depends on <code>androidx.concurrent:concurrent-futures-ktx</code> instead of <code>androidx.concurrent:concurrent-futures</code>.</li> <li>Updated Kotlin to 1.9.20.</li> <li>Updated Android Gradle Plugin to 8.1.3.</li> <li>Updated <code>apksig</code> to 8.1.3.</li> <li>Updated <code>androidx.navigation</code> to 2.7.5 (sample apps dependency).</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_68","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Return dummy <code>DisposableSubscription</code> object when attempting to add an already registered listener to a session instead of a new one each time.</li> <li>Don't notify an already registered listener with snapshot of current session's state or progress when attempting to add it again.</li> <li>Require a <code>DisposableSubscriptionContainer</code> when adding a listener to a session to avoid an error-prone practice of adding the subscription to a subscriptions bag manually. Documentation and Java sample app were updated accordingly.</li> <li>Make confirmation Activity appear less jarring on finish.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#public-api-changes_28","level":3,"title":"Public API changes","text":"<ul> <li>Breaking: <code>Session.addStateListener()</code> and <code>ProgressSession.addProgressListener()</code> now require a <code>DisposableSubscriptionContainer</code> to be provided.</li> <li>Extension functions <code>PackageInstaller.getSession()</code>, <code>PackageInstaller.getSessions()</code>, <code>PackageInstaller.getActiveSessions()</code> and their respective counterparts for <code>PackageUninstaller</code> are not inline functions anymore.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-022-2023-11-03","level":2,"title":"Version 0.2.2 (2023-11-03)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_69","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Fix duplicate session's state change notifications in some cases (e.g. after process restart and re-attaching a listener when session's been completed right before). This also fixes <code>IllegalStateException</code> in <code>Session.await()</code> in these cases.</li> <li>Make confirmation's background fully transparent.</li> <li>Don't display loading indicator during confirmation from system.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-021-2023-10-30","level":2,"title":"Version 0.2.1 (2023-10-30)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_70","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Fix issues with incorrect sessions behavior when multiple session confirmations are active simultaneously and are stacked up on each other.</li> <li>Remove unnecessary Activity flags from <code>AndroidManifest.xml</code>.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-020-2023-10-28","level":2,"title":"Version 0.2.0 (2023-10-28)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#dependencies_29","level":3,"title":"Dependencies","text":"<ul> <li>Updated AndroidX Room to 2.6.0.</li> <li>Updated RecyclerView to 1.3.2 (sample apps dependency).</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_71","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Remove intrusive behavior of <code>DEFERRED</code> confirmation: dismissing keyguard, using full-screen intent. <code>USE_FULL_SCREEN_INTENT</code> and <code>DISABLE_KEYGUARD</code> permissions were removed. Also it allowed to make <code>DEFERRED</code> confirmation's behavior consistent on old and new Android versions, as on old versions full-screen intent behaved like <code>IMMEDIATE</code> confirmation.</li> <li>Enable vibration and lights for library's notification channel.</li> <li>Make confirmation's background semi-transparent.</li> <li>Fix incorrect handling of <code>file:</code> URIs in sample apps.</li> <li>Add documentation about permissions and library's architecture.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-016-2023-10-17","level":2,"title":"Version 0.1.6 (2023-10-17)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#dependencies_30","level":3,"title":"Dependencies","text":"<ul> <li>Updated Dokka to 1.9.10 Beta.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_72","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Extend from <code>FileProvider</code> and declare it in <code>AndroidManifest.xml</code> instead to avoid possible issues and providers conflicts.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-015-2023-10-11","level":2,"title":"Version 0.1.5 (2023-10-11)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_73","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Fix an issue with sessions' <code>commit()</code> implementation when it allowed to commit while session is already in the process of being committed.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-014-2023-10-10","level":2,"title":"Version 0.1.4 (2023-10-10)","text":"<p>This release bumps <code>compileSdk</code> to 34.</p>","path":["Change Log"],"tags":[]},{"location":"changelog/#dependencies_31","level":3,"title":"Dependencies","text":"<ul> <li>Updated Gradle wrapper to 8.4.</li> <li>Updated Android Gradle Plugin to 8.1.2.</li> <li>Updated <code>apksig</code> to 8.1.2.</li> <li>Updated <code>androidx.annotation</code> to 1.7.0.</li> <li>Updated <code>androidx.core</code> to 1.12.0.</li> <li>Updated <code>androidx.activity</code> to 1.8.0 (sample apps dependency).</li> <li>Updated <code>androidx.lifecycle</code> to 2.6.2 (sample apps dependency).</li> <li>Updated <code>androidx.navigation</code> to 2.7.4 (sample apps dependency).</li> <li>Updated Material Components to 1.10.0 (sample apps dependency).</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_74","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Make it possible to commit an arbitrary session more than once (if its confirmation was interrupted, e.g. by completely exiting the app).</li> <li>Update <code>compileSdk</code> and sample apps' <code>targetSdk</code> to 34.</li> <li>Change primary color of color scheme in sample apps to match the logo.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-013-2023-09-23","level":2,"title":"Version 0.1.3 (2023-09-23)","text":"<p>Added a logo for the library! Sample apps icon now uses the logo too.</p>","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_75","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Small optimization in <code>SESSION_BASED</code> package installer.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-012-2023-09-19","level":2,"title":"Version 0.1.2 (2023-09-19)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_76","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Fix deadlock in <code>SESSION_BASED</code> package installer.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-011-2023-08-30","level":2,"title":"Version 0.1.1 (2023-08-30)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_77","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Add index for <code>lastLaunchTimestamp</code> internal database column.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-010-2023-08-24","level":2,"title":"Version 0.1.0 (2023-08-24)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#dependencies_32","level":3,"title":"Dependencies","text":"<ul> <li>Updated Kotlin to 1.9.10.</li> <li>Updated Android Gradle Plugin to 8.1.1.</li> <li>Updated <code>apksig</code> to 8.1.1.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_78","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Don't add <code>DisposableSubscription</code> instance to <code>DisposableSubscriptionContainer</code> if it's already added.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#public-api-changes_29","level":3,"title":"Public API changes","text":"<ul> <li>Breaking: <code>Sequence&lt;Apk&gt;.filterIncompatible()</code> in <code>ApkSplits</code> is renamed to <code>Sequence&lt;Apk&gt;.filterCompatible()</code>.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-0011-2023-08-19","level":2,"title":"Version 0.0.11 (2023-08-19)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#dependencies_33","level":3,"title":"Dependencies","text":"<ul> <li>Replaced transitive <code>kotlinx-coroutines-android</code> dependency with <code>kotlinx-coroutines-core</code>.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_79","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Handle sessions' cancellation synchronously.</li> <li>Fix falling back to using <code>ContentResolver</code> instead of Java File API when file path has <code>mnt/media_rw</code> in the middle.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-0010-2023-08-18","level":2,"title":"Version 0.0.10 (2023-08-18)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#dependencies_34","level":3,"title":"Dependencies","text":"<ul> <li>Updated Kotlin to 1.9.0.</li> <li>Updated Android Gradle Plugin to 8.1.0.</li> <li>Updated <code>apksig</code> to 8.1.0.</li> <li>Updated Gradle wrapper to 8.3.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_80","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Reduce count of threads in shared Ackpine thread pool.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#public-api-changes_30","level":3,"title":"Public API changes","text":"<ul> <li>Due to updating to Kotlin 1.9, <code>entries</code> property was added to <code>Confirmation</code>, <code>InstallerType</code>, <code>Abi</code> and <code>Dpi</code> enums.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-009-2023-08-16","level":2,"title":"Version 0.0.9 (2023-08-16)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_81","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Detach state listener when session reaches terminal state in <code>Session.await()</code>.</li> <li>Don't store strong references in <code>DisposableSubscription</code> implementations.</li> <li>Don't add listener instance to session if it's already registered.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-008-2023-08-15","level":2,"title":"Version 0.0.8 (2023-08-15)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_82","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Fix <code>No such file or directory</code> error when using <code>INTENT_BASED</code> installer on API &lt; 24 and APK is not readable directly.</li> <li>Improve progress reports for <code>INTENT_BASED</code> installer.</li> <li>Add documentation for <code>AssetFileProvider</code>.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-007-2023-08-14","level":2,"title":"Version 0.0.7 (2023-08-14)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_83","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Don't expose <code>file:</code> URIs on API level &gt;= 24 when using intent-based installer. Now <code>ackpine-core</code> artifact declares <code>FileProvider</code> in its manifest to support this.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-006-2023-08-12","level":2,"title":"Version 0.0.6 (2023-08-12)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_84","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Fix incorrect handling of <code>file:</code> URIs in <code>ZippedFileProvider</code>.</li> <li>Fix NPE when iterating APKs sequence in Java sample.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-005-2023-08-08","level":2,"title":"Version 0.0.5 (2023-08-08)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_85","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Allow to configure <code>requireUserAction</code> option when creating <code>InstallParameters</code>.</li> <li>Revert to not showing a full screen loading indicator after session is committed to avoid unnecessary UI interruption when user's action is not required.</li> <li>Fix session not completing with failure when navigating back from <code>SessionCommitActivity</code> on API &gt;= 33 if predictive back gesture is not enabled.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-004-2023-08-04","level":2,"title":"Version 0.0.4 (2023-08-04)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_86","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Finish activity with loading indicator after install session was approved by user (using <code>SESSION_BASED</code> installer).</li> <li>Purge sessions in terminal state from internal database one day after last launch.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-003-2023-08-03","level":2,"title":"Version 0.0.3 (2023-08-03)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_87","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Fix <code>IllegalStateException</code> in <code>Session.await()</code> when session has failed with an exception.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#public-api-changes_31","level":3,"title":"Public API changes","text":"<ul> <li>Now all Ackpine artifacts have different Android namespaces. Generated <code>R</code> classes coming from the library need to be re-imported if they were used in client code.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-002-2023-07-31","level":2,"title":"Version 0.0.2 (2023-07-31)","text":"","path":["Change Log"],"tags":[]},{"location":"changelog/#dependencies_35","level":3,"title":"Dependencies","text":"<ul> <li>Updated <code>kotlinx.coroutines</code> to 1.7.3.</li> <li>Updated AndroidX Room to 2.5.2.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#bug-fixes-and-improvements_88","level":3,"title":"Bug fixes and improvements","text":"<ul> <li>Show a full screen loading indicator after session is committed if it takes long to launch system confirmation activity.</li> <li>Fix race when session is failing with <code>Session $id is dead</code> instead of other reasons.</li> <li>Create session first and only then persist it in <code>PackageInstaller</code> and <code>PackageUninstaller</code> implementations to avoid persisting if session factory threw an exception.</li> <li>Fix night theme in sample app.</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#public-api-changes_32","level":3,"title":"Public API changes","text":"<ul> <li>Added constructors with default values to <code>InstallFailure</code> descendants (via <code>@JvmOverloads</code>).</li> </ul>","path":["Change Log"],"tags":[]},{"location":"changelog/#version-001-2023-07-26","level":2,"title":"Version 0.0.1 (2023-07-26)","text":"<p>Initial release.</p>","path":["Change Log"],"tags":[]},{"location":"faq/","level":1,"title":"FAQ","text":"","path":["FAQ"],"tags":[]},{"location":"faq/#my-session-is-stuck-whats-wrong","level":3,"title":"My session is stuck — what's wrong?","text":"<p><code>Session</code> is passive by design — it won't advance its state unless your code drives it:</p> <ul> <li>A session in Pending means the session was never launched.</li> <li>A session in Active means preparation is still in progress, or was interrupted and needs to be launched again.</li> <li>A session in Awaiting means preparation is complete but the session was never committed.</li> <li>A session in Committed means that the session waits for confirmation from user.</li> </ul> <p>Use <code>Session.TerminalStateListener.bind()</code> (Java) or <code>Session.await()</code> (Kotlin), which handle the session lifecycle. See Getting Started.</p> <p>In case of a session stuck in Committed state, the reason is most probably the lack of confirmation from user. By default, Ackpine will post a high-priority notification to request confirmation from user. If an app doesn't have a permission to display notifications (for example, <code>POST_NOTIFICATIONS</code> permission is not granted, or user disabled notifications for the app), session will stay in <code>Committed</code> state without progressing.</p> <p>To fix this, either ensure that your app can post notifications, or change confirmation behavior to <code>Confirmation.IMMEDIATE</code> when creating a session. <code>Confirmation.IMMEDIATE</code> requires the app to be in foreground. See confirmation mode details.</p>","path":["FAQ"],"tags":[]},{"location":"faq/#which-artifacts-do-i-need","level":3,"title":"Which artifacts do I need?","text":"<ul> <li>Always: <code>ackpine-core</code> — runtime implementation (pulls in <code>ackpine-api</code> transitively).</li> <li>Kotlin coroutines: add <code>ackpine-ktx</code> for <code>Session.await()</code> and DSL parameter builders.</li> <li>Split APKs: add <code>ackpine-splits</code> (and <code>ackpine-splits-ktx</code> for Kotlin extensions) for reading and manipulating split APK packages. See Split APKs.</li> <li>APKs from assets: add <code>ackpine-assets</code> for a <code>ContentProvider</code> that reads APKs bundled in your app's assets.</li> <li>Privileged installs: add <code>ackpine-shizuku</code> (and <code>ackpine-shizuku-ktx</code> for Kotlin DSL) for Shizuku-backed installs. See Shizuku.</li> <li>Testing: add <code>ackpine-test</code> as a test dependency for in-memory test doubles. See Testing.</li> </ul> <p>See the module dependency graph for a visual overview.</p>","path":["FAQ"],"tags":[]},{"location":"faq/#does-ackpine-support-silent-installs","level":3,"title":"Does Ackpine support silent installs?","text":"<p>Only in specific scenarios:</p> <ul> <li>Via Shizuku plugin: when your app has root or ADB shell access through Shizuku, installs and uninstalls can bypass user confirmation entirely.</li> <li>Via <code>requireUserAction = false</code> (delicate API): on API level 31+, if certain conditions are met (e.g. the app is updating itself, or the installer has the appropriate permissions), the system may skip user confirmation. See User's confirmation for details and caveats.</li> <li>Via being a device owner / affiliated profile owner / system-signed app: Ackpine uses Android's <code>PackageInstaller</code> which will install silently if an app has such privileges.</li> </ul> <p>In all other cases, Android requires user confirmation for package installation.</p>","path":["FAQ"],"tags":[]},{"location":"faq/#when-should-i-use-session_based-vs-intent_based-installer","level":3,"title":"When should I use <code>SESSION_BASED</code> vs <code>INTENT_BASED</code> installer?","text":"<p><code>SESSION_BASED</code> (default on API 21+) uses Android's <code>PackageInstaller</code> API. It supports split APKs, plugins, preapproval, constraints and other options.</p> <p><code>INTENT_BASED</code> uses <code>ACTION_INSTALL_PACKAGE</code> intent. It is more limited — no splits, no advanced features. It is the only option on API level &lt; 21. This option may be more stable on certain Android distributions, especially from Chinese vendors.</p> <p>If your <code>minSdk</code> is 21 or higher, and you don't have a specific reason to use intents, stick with <code>SESSION_BASED</code>. See Installer type for invariants enforced by the install parameters builder.</p>","path":["FAQ"],"tags":[]},{"location":"faq/#how-do-i-uninstall-an-app","level":3,"title":"How do I uninstall an app?","text":"<p>The API mirrors the install flow. Use <code>PackageUninstaller</code> instead of <code>PackageInstaller</code>:</p> KotlinJava <pre><code>val packageUninstaller = PackageUninstaller.getInstance(context)\nval result = packageUninstaller.createSession(\"com.example.app\").await()\nwhen (result) {\n    Session.State.Succeeded -&gt; println(\"Uninstalled\")\n    is Session.State.Failed -&gt; println(result.failure.message)\n}\n</code></pre> <pre><code>var packageUninstaller = PackageUninstaller.getInstance(context);\nvar parameters = new UninstallParameters.Builder(\"com.example.app\").build();\nvar session = packageUninstaller.createSession(parameters);\nvar subscriptions = new DisposableSubscriptionContainer();\nSession.TerminalStateListener.bind(session, subscriptions)\n        .addOnSuccessListener(sessionId -&gt; System.out.println(\"Uninstalled\"))\n        .addOnFailureListener((sessionId, failure) -&gt; System.out.println(failure.getMessage()));\n</code></pre> <p>See Getting Started for more detailed examples. Configuration options for uninstall sessions are described in the Configuration page.</p>","path":["FAQ"],"tags":[]},{"location":"faq/#what-happens-if-my-app-is-killed-during-installation","level":3,"title":"What happens if my app is killed during installation?","text":"<p>Session state is persisted to a database, so sessions survive process death. After your app restarts, re-retrieve the session by its saved ID from <code>PackageInstaller</code> or <code>PackageUninstaller</code> and re-attach your listeners (via <code>Session.TerminalStateListener.bind()</code> / <code>Session.await()</code>). The session will resume from where it left off — if preparations were interrupted, attaching these listeners again re-starts preparation; if confirmation was interrupted, attaching these listeners again re-requests confirmation.</p> <p>See Handling process death for code examples and Architecture for the design behind this.</p>","path":["FAQ"],"tags":[]},{"location":"permissions/","level":1,"title":"Permissions","text":"<p>Ackpine adds the following permissions to <code>AndroidManifest.xml</code>:</p> <ul> <li><code>WRITE_EXTERNAL_STORAGE</code> — used by <code>INTENT_BASED</code> package installer to create temporary APK copy;</li> <li><code>REQUEST_INSTALL_PACKAGES</code> and <code>REQUEST_DELETE_PACKAGES</code> — self-explanatory;</li> <li><code>VIBRATE</code> — to be able to set heads-up notifications' vibration when using <code>DEFERRED</code> confirmation;</li> <li><code>POST_NOTIFICATIONS</code> — for posting notifications when using <code>DEFERRED</code> confirmation;</li> <li><code>UPDATE_PACKAGES_WITHOUT_USER_ACTION</code> — to be able to leverage <code>requireUserAction</code> feature on API 31+;</li> <li><code>ENFORCE_UPDATE_OWNERSHIP</code> — to be able to leverage update ownership enforcement feature on API 34+.</li> </ul> <p>If you don't need some of the features listed above and don't want to have unneeded permissions in your app, you can remove them from the resulting merged <code>AndroidManifest.xml</code>, but do so carefully to not break the library functionality you use:</p> <pre><code>&lt;uses-permission\n    android:name=\"android.permission.PERMISSION_TO_REMOVE\"\n    tools:node=\"remove\" /&gt;\n</code></pre> <p>For getting correct uninstall results, your app must have permission to query the uninstalled package. Add this to your <code>AndroidManifest.xml</code>: <pre><code>&lt;queries&gt;\n    &lt;package android:name=\"com.your.uninstalled.package\" /&gt;\n&lt;/queries&gt;\n</code></pre></p> <p>Or, if you must, add the <code>QUERY_ALL_PACKAGES</code> permission. Be careful about not violating Google Play policies in regards to this permission.</p>","path":["Permissions"],"tags":[]},{"location":"guide/configuration/","level":1,"title":"Configuration","text":"<p>Sessions can be configured via <code>InstallParameters</code> and <code>UninstallParameters</code>. For an overview of how sessions work, see Architecture.</p>","path":["Guide","Configuration"],"tags":[]},{"location":"guide/configuration/#session-parameters","level":2,"title":"Session parameters","text":"<p>An instance of session parameters is created with a builder. <code>ackpine-ktx</code> artifact contains DSL APIs for configuring sessions.</p> <p>An example of creating a session with custom parameters:</p> KotlinJava <pre><code>val session = packageInstaller.createSession(baseApkUri) {\n    apks += apkSplitsUris\n    confirmation = Confirmation.DEFERRED\n    installerType = InstallerType.SESSION_BASED\n    installMode = InstallMode.InheritExisting(\n        packageName = \"com.example.package\",\n        dontKillApp = true\n    )\n    name = fileName\n    requireUserAction = true\n    requestUpdateOwnership = true\n    packageSource = PackageSource.Store\n    notification {\n        title = InstallMessageTitle\n        contentText = InstallMessage(fileName)\n        icon = InstallIcon\n    }\n    preapproval(\n        packageName = \"com.example.package\",\n        label = \"Sample App\",\n        locale = ULocale.US\n    ) {\n        icon = iconUri\n        fallbackToOnDemandApproval = true\n    }\n    constraints(timeout = 1.minutes) {\n        timeoutStrategy = TimeoutStrategy.CommitEagerly\n        isAppNotForegroundRequired = true\n        isAppNotInteractingRequired = true\n    }\n}\n\nobject InstallMessageTitle : ResolvableString.Resource() {\n    private const val serialVersionUID = -1310602635578779088L\n    override fun stringId() = R.string.install_message_title\n    private fun readResolve(): Any = InstallMessageTitle\n}\n\nclass InstallMessage(fileName: String) : ResolvableString.Resource(fileName) {\n    override fun stringId() = R.string.install_message\n    private companion object {\n        private const val serialVersionUID = 4749568844072243110L\n    }\n}\n\nobject InstallIcon : DrawableId {\n    private const val serialVersionUID = 3692803605642002954L\n    override fun drawableId() = R.drawable.ic_install\n    private fun readResolve(): Any = InstallIcon\n}\n</code></pre> <pre><code>var installMode = new InstallMode.InheritExisting(\"com.example.package\", true);\nvar notificationData = new NotificationData.Builder()\n        .setTitle(Resources.INSTALL_MESSAGE_TITLE)\n        .setContentText(new Resources.InstallMessage(fileName))\n        .setIcon(Resources.INSTALL_ICON)\n        .build();\nvar preapproval = new InstallPreapproval.Builder(\"com.example.package\", \"Sample App\", ULocale.US)\n        .setIcon(iconUri)\n        .setFallbackToOnDemandApproval(true)\n        .build();\nvar timeout = Duration.ofMinutes(1);\n// Or use raw millis value on older Android versions, e.g. 60000L\nvar constraints = new InstallConstraints.Builder(timeout)\n        .setTimeoutStrategy(TimeoutStrategy.COMMIT_EAGERLY)\n        .setAppNotForegroundRequired(true)\n        .setAppNotInteractingRequired(true)\n        .build();\nvar parameters = new InstallParameters.Builder(baseApkUri)\n        .addApks(apkSplitsUris)\n        .setConfirmation(Confirmation.DEFERRED)\n        .setInstallerType(InstallerType.SESSION_BASED)\n        .setInstallMode(installMode)\n        .setName(fileName)\n        .setRequireUserAction(true)\n        .setRequestUpdateOwnership(true)\n        .setPackageSource(PackageSource.STORE)\n        .setNotificationData(notificationData)\n        .setPreapproval(preapproval)\n        .setConstraints(constraints)\n        .build();\nvar session = packageInstaller.createSession(parameters);\n\npublic abstract class Resources {\n\n    public static final ResolvableString INSTALL_MESSAGE_TITLE = new InstallMessageTitle();\n    public static final DrawableId INSTALL_ICON = new InstallIcon();\n\n    private static class InstallMessageTitle extends ResolvableString.Resource {\n\n        @Serial\n        private static final long serialVersionUID = -1310602635578779088L;\n\n        @Override\n        protected int stringId() {\n            return R.string.install_message_title;\n        }\n\n        @Serial\n        private Object readResolve() {\n            return Resources.INSTALL_MESSAGE_TITLE;\n        }\n    }\n\n    public static class InstallMessage extends ResolvableString.Resource {\n\n        @Serial\n        private static final long serialVersionUID = 4749568844072243110L;\n\n        public InstallMessage(String fileName) {\n            super(fileName);\n        }\n\n        @Override\n        protected int stringId() {\n            return R.string.install_message;\n        }\n    }\n\n    private static class InstallIcon implements DrawableId {\n\n        @Serial\n        private static final long serialVersionUID = 3692803605642002954L;\n\n        @Override\n        public int drawableId() {\n            return R.drawable.ic_install;\n        }\n\n        @Serial\n        private Object readResolve() {\n            return Resources.INSTALL_ICON;\n        }\n    }\n}\n</code></pre>","path":["Guide","Configuration"],"tags":[]},{"location":"guide/configuration/#api-level-compatibility","level":2,"title":"API level compatibility","text":"<p>Most configuration options are applied on a best-effort basis — options unavailable on the device's API level are silently ignored. The table below summarizes minimum API levels for each feature.</p> Feature Min API Fallback on lower API <code>SESSION_BASED</code> installer 21 <code>INTENT_BASED</code> is used Split APK installation 21 Not supported, throws <code>SplitPackagesNotSupportedException</code> <code>PACKAGE_INSTALLER_BASED</code> uninstaller 21 <code>INTENT_BASED</code> is used <code>requireUserAction</code> 31 Ignored <code>PackageSource</code> 33 Ignored <code>InstallMode.InheritExisting.dontKillApp</code> 34 Ignored <code>requestUpdateOwnership</code> 34 Ignored Install preapproval 34 Ignored Install constraints 34 Ignored Shizuku plugin 24 N/A (requires <code>ackpine-shizuku</code> dependency)","path":["Guide","Configuration"],"tags":[]},{"location":"guide/configuration/#users-confirmation","level":2,"title":"User's confirmation","text":"<p>A strategy for handling user's confirmation of installation or uninstallation. <code>Confirmation</code> can be <code>DEFERRED</code> (used by default) or <code>IMMEDIATE</code>.</p> <ul> <li> <p><code>DEFERRED</code> (default) — user will be shown a high-priority notification which will launch confirmation activity.</p> </li> <li> <p><code>IMMEDIATE</code> — user will be prompted to confirm installation or uninstallation right away. Suitable for launching session directly from the UI when app is in foreground.</p> </li> </ul> <p>It's also possible to configure <code>requireUserAction</code> option for install sessions. It will have effect only on API level 31+. If set to <code>false</code>, user's confirmation from system won't be triggered if some conditions are met. See the details here.</p> <p><code>requireUserAction</code> is a delicate API. This option is unstable for use on different Android versions from different vendors. It's recommended to avoid using it on API level &lt; 33 and on devices with modified OS package installer, most notably from Chinese vendors, unless your app is privileged for silent installs.</p> <p>If <code>DEFERRED</code> confirmation is never used in the app, it's possible to remove Ackpine's notification channel from the app's notification settings, which is used for posting confirmation notifications and is set up automatically. For this, disable automatic Ackpine initialization by adding the following lines to the app's <code>AndroidManifest.xml</code>: <pre><code>&lt;provider\n    android:name=\"androidx.startup.InitializationProvider\"\n    android:authorities=\"${applicationId}.androidx-startup\"\n    android:exported=\"false\"\n    tools:node=\"merge\"&gt;\n    &lt;meta-data\n        android:name=\"ru.solrudev.ackpine.AckpineInitializer\"\n        tools:node=\"remove\" /&gt;\n&lt;/provider&gt;\n</code></pre> Then, if the notification channel was already created previously, call <code>Ackpine.deleteNotificationChannel()</code> when initializing the app.</p>","path":["Guide","Configuration"],"tags":[]},{"location":"guide/configuration/#notification","level":2,"title":"Notification","text":"<p>It is possible to provide notification title, text and icon.</p> <p>Note</p> <p>Any configuration for notification will be ignored if <code>Confirmation</code> is set to <code>IMMEDIATE</code>, because the notification will not be shown.</p> <p><code>ResolvableString</code> is a type used for <code>NotificationData</code> text values. It allows to incapsulate an Android string resource (with arguments) which will be resolved only when notification will be shown, a hardcoded string value or a default value from Ackpine library if nothing was set.</p> <p><code>DrawableId</code> holds the drawable ID which is used for notification icon.</p> <p><code>android.R.drawable.ic_dialog_alert</code> is used as a default icon.</p> <p>Why custom classes?</p> <p><code>ResolvableString</code> and <code>DrawableId</code> are persisted to a database, and Android resource IDs can change across builds. Custom subclasses resolve the resource ID at call time, keeping it up-to-date after app updates. See this section for the full explanation.</p> <p><code>ResolvableString</code> can also be useful outside of session parameters — for example, for displaying localized error messages or status text in your own UI. For such general-purpose strings that are not persisted in storage, use the simpler <code>ResolvableString.transientResource()</code> factory instead of defining custom subclasses:</p> KotlinJava <pre><code>// In a ViewModel, use transientResource() for UI-only strings\nval error = ResolvableString.transientResource(R.string.session_error_with_reason, message)\n\n// For hardcoded strings\nval errorMessage = ResolvableString.raw(exception.message.orEmpty())\n</code></pre> <pre><code>// In a ViewModel, use transientResource() for UI-only strings\nvar error = ResolvableString.transientResource(R.string.session_error_with_reason, message);\n\n// For hardcoded strings\nvar errorMessage = ResolvableString.raw(exception.getMessage());\n</code></pre>","path":["Guide","Configuration"],"tags":[]},{"location":"guide/configuration/#session-name","level":2,"title":"Session name","text":"<p>Available for install sessions. You can provide an optional session <code>name</code> parameter to be used in default notification content text. It may be a name of the app being installed or a file name. It will be ignored if you specify custom notification content text or set <code>Confirmation</code> to <code>IMMEDIATE</code>.</p>","path":["Guide","Configuration"],"tags":[]},{"location":"guide/configuration/#installer-type","level":2,"title":"Installer type","text":"<p>Available for install sessions. Ackpine supports two different package installer implementations: Android's <code>PackageInstaller</code> and an intent with <code>ACTION_INSTALL_PACKAGE</code> action. They're configured with <code>InstallerType</code> enum with entries <code>SESSION_BASED</code> and <code>INTENT_BASED</code> respectively.</p> <p><code>InstallParameters</code> builder will maintain the following invariants when configuring the installer type:</p> <ul> <li>When on API level &lt; 21, <code>INTENT_BASED</code> is always set regardless of the provided value;</li> <li>When on API level 21+ and <code>InstallParameters.Builder.apks</code> contains more than one entry, <code>SESSION_BASED</code> is always set regardless of the provided value.</li> </ul> <p>By default, the value of installer type on API level &lt; 21 is <code>INTENT_BASED</code>, and on API level 21+ it is <code>SESSION_BASED</code>.</p>","path":["Guide","Configuration"],"tags":[]},{"location":"guide/configuration/#uninstaller-type","level":2,"title":"Uninstaller type","text":"<p>Available for uninstall sessions. Ackpine supports two different package uninstaller implementations: Android's <code>PackageInstaller</code> and an intent with <code>ACTION_UNINSTALL_PACKAGE</code> or <code>ACTION_DELETE</code> action. They're configured with <code>UninstallerType</code> enum with entries <code>PACKAGE_INSTALLER_BASED</code> and <code>INTENT_BASED</code> respectively.</p> <p>By default, the value of uninstaller type on API level &lt; 21 is <code>INTENT_BASED</code>, and on API level 21+ it is <code>PACKAGE_INSTALLER_BASED</code>.</p>","path":["Guide","Configuration"],"tags":[]},{"location":"guide/configuration/#install-mode","level":2,"title":"Install mode","text":"<p>Available for install sessions. Takes effect only when using <code>SESSION_BASED</code> installer. See <code>InstallMode</code> API reference.</p> <ul> <li> <p><code>Full</code> (default) — mode for an install session whose staged APKs should fully replace any existing APKs for the target app.</p> </li> <li> <p><code>InheritExisting</code> — mode for an install session that should inherit any existing APKs for the target app, unless they have been explicitly overridden (based on split name) by the session.</p> <p>If there are no existing APKs for the target app, this behaves like <code>Full</code>.</p> <p>Requires package name of the app being installed. If the APKs staged in the session aren't consistent with the set package name, the install will fail.</p> <p>Optionally, it's possible to request the system to not kill any of the package's running processes as part of a session in which splits are being added by setting <code>dontKillApp</code> to <code>true</code>. This option takes effect only on API level 34+.</p> </li> </ul>","path":["Guide","Configuration"],"tags":[]},{"location":"guide/configuration/#preapproval","level":2,"title":"Preapproval","text":"<p>Available for install sessions on API level 34+. <code>InstallPreapproval</code> attempts to request the approval before committing this session. See the details here.</p> <p>Preapproval requires package name of the app being installed, label representing it and locale used to get the label to be provided. Optionally, it's possible to also provide the app's icon via <code>Uri</code>.</p> <p>If preapproval is not available on the device, session will fail. If you want to instead fall back to on-demand user approval, set the <code>fallbackToOnDemandApproval</code> property to <code>true</code> when configuring <code>InstallPreapproval</code>.</p>","path":["Guide","Configuration"],"tags":[]},{"location":"guide/configuration/#constraints","level":2,"title":"Constraints","text":"<p>Available for install sessions on API level 34+. <code>InstallConstraints</code> specify the conditions to check against for the installed packages. This can be used by app stores to deliver auto updates without disrupting the user experience (referred as gentle update) - for example, an app store might hold off updates when it find out the app to update is interacting with the user. See the details here.</p> <p>Installer waits for constraints to be satisfied, so to configure them, timeout duration is required to be provided after which installer will act based on set <code>TimeoutStrategy</code>.</p> <p><code>TimeoutStrategy</code> may be one of the following:</p> <ul> <li><code>Fail</code> (default) - installer reports failure on timeout if constraints are not met.</li> <li><code>CommitEagerly</code> - installer commits session immediately after timeout even if constraints are not met.</li> <li><code>Retry</code> - installer retries waiting for constraints to be satisfied with the same timeout if constraints were not met after the first attempt. Requires <code>retries</code> parameter to be provided when created.</li> </ul> <p>There's a preset for gentle updates which can be used like this:</p> KotlinJava <pre><code>val session = packageInstaller.createSession(apkUri) {\n    constraints = InstallConstraints.gentleUpdate(\n        timeout = 1.minutes,\n        timeoutStrategy = TimeoutStrategy.CommitEagerly // optional\n    )\n}\n</code></pre> <pre><code>var constraints = InstallConstraints.gentleUpdate(60000L,\n        /* optional */ TimeoutStrategy.COMMIT_EAGERLY);\nvar session = packageInstaller.createSession(new InstallParameters.Builder(apkUri)\n        .setConstraints(constraints)\n        .build());\n</code></pre>","path":["Guide","Configuration"],"tags":[]},{"location":"guide/configuration/#update-ownership","level":2,"title":"Update ownership","text":"<p>Available for install sessions on API level 34+.</p> <p>Optionally indicate whether the package being installed needs the update ownership enforcement. Once the update ownership enforcement is enabled, the other installers will need the user action to update the package even if the installers have been granted the <code>INSTALL_PACKAGES</code> permission. Default to <code>false</code>. The update ownership enforcement can only be enabled on initial installation. Setting this to <code>true</code> on package update is a no-op.</p>","path":["Guide","Configuration"],"tags":[]},{"location":"guide/configuration/#package-source","level":2,"title":"Package source","text":"<p>Available for install sessions.</p> <p>Optionally indicates the package source of the app being installed. This is informational and may be used as a signal by the system. Default value is <code>PackageSource.Unspecified</code>.</p> <p>Setting this value to <code>PackageSource.LocalFile</code> or <code>PackageSource.DownloadedFile</code> will disable restricted settings for the app being installed on API level 33+.</p>","path":["Guide","Configuration"],"tags":[]},{"location":"guide/configuration/#plugins","level":2,"title":"Plugins","text":"<p>Ackpine supports plugins. They are available for sessions that use Android's <code>PackageInstaller</code> API.</p> <p>At the moment, there are two Ackpine plugins: <code>ShizukuPlugin</code> and <code>ShizukuUninstallPlugin</code>. See Architecture for how the plugin system works internally.</p>","path":["Guide","Configuration"],"tags":[]},{"location":"guide/getting_started/","level":1,"title":"Getting Started","text":"<p>To obtain an instance of <code>PackageInstaller</code> or <code>PackageUninstaller</code>, use the <code>getInstance(Context)</code> method:</p> KotlinJava <pre><code>val packageInstaller = PackageInstaller.getInstance(context)\nval packageUninstaller = PackageUninstaller.getInstance(context)\n</code></pre> <pre><code>var packageInstaller = PackageInstaller.getInstance(context);\nvar packageUninstaller = PackageUninstaller.getInstance(context);\n</code></pre>","path":["Guide","Getting Started"],"tags":[]},{"location":"guide/getting_started/#simple-session-launch","level":2,"title":"Simple session launch","text":"<p>Launching an install or uninstall session with default parameters and getting its result back is as easy as writing this:</p> KotlinJava <pre><code>try {\n    when (val result = packageInstaller.createSession(apkUri).await()) {\n        Session.State.Succeeded -&gt; println(\"Success\")\n        is Session.State.Failed -&gt; println(result.failure.message)\n    }\n} catch (cancellationException: CancellationException) {\n    println(\"Cancelled\")\n    throw cancellationException\n} catch (exception: Exception) {\n    println(exception)\n}\n</code></pre> <p>Session launches when <code>await()</code> is called.</p> <pre><code>var subscriptions = new DisposableSubscriptionContainer();\nvar parameters = new InstallParameters.Builder(apkUri).build();\nvar session = packageInstaller.createSession(parameters);\nSession.TerminalStateListener.bind(session, subscriptions)\n        .addOnCancelListener(sessionId -&gt; System.out.println(\"Cancelled\"))\n        .addOnSuccessListener(sessionId -&gt; System.out.println(\"Success\"))\n        .addOnFailureListener((sessionId, failure) -&gt; {\n            if (failure instanceof Failure.Exceptional f) {\n                System.out.println(f.getException());\n            } else {\n                System.out.println(failure.getMessage());\n            }\n        });\n</code></pre> <p>Session launches when <code>TerminalStateListener.bind()</code> is called.</p> <p>It works as long as you don't care about UI lifecycle and unpredictable situations such as process death.</p>","path":["Guide","Getting Started"],"tags":[]},{"location":"guide/getting_started/#handling-ui-lifecycle","level":2,"title":"Handling UI lifecycle","text":"<p>If you're launching a session inside a long-living service which is not expected to be killed (such as a foreground service), the previous example is good to go. However, when you are dealing with UI components such as Activities or Fragments, it's good practice to remove attached state listeners when appropriate:</p> KotlinJava <p>When using <code>ackpine-ktx</code> artifact and calling <code>Session.await()</code>, the listener will be automatically detached when parent coroutine scope is cancelled. So if you're calling <code>await()</code> inside of a <code>viewModelScope</code> or <code>lifecycleScope</code>, it should be fine. Note that cancelling <code>await()</code> also cancels the session, this is done to respect coroutines' structured concurrency.</p> <pre><code>var subscriptions = new DisposableSubscriptionContainer();\nvar session = packageInstaller.createSession(...);\nSession.TerminalStateListener.bind(session, subscriptions)\n        .addOnSuccessListener(...)\n        .addOnFailureListener(...);\n\n// when lifecycle is destroyed\nsubscriptions.clear();\n</code></pre>","path":["Guide","Getting Started"],"tags":[]},{"location":"guide/getting_started/#handling-process-death","level":2,"title":"Handling process death","text":"<p>Handling process death is not any different with Ackpine as with any other persisted state handling. You can save a session's ID and then re-retrieve the session from <code>PackageInstaller</code>:</p> KotlinJava <pre><code>savedStateHandle[SESSION_ID_KEY] = session.id\n\n// after process restart\nval id: UUID? = savedStateHandle[SESSION_ID_KEY]\nif (id != null) {\n    val result = packageInstaller.getSession(id)?.await()\n    // or anything else you want to do with the session\n}\n</code></pre> <pre><code>savedStateHandle.set(SESSION_ID_KEY, session.getId());\n\n// after process restart\nUUID id = savedStateHandle.get(SESSION_ID_KEY);\nif (id != null) {\n    final var future = packageInstaller.getSessionAsync(id);\n    // using Guava\n    Futures.addCallback(future, new FutureCallback&lt;ProgressSession&lt;InstallFailure&gt;&gt;() {\n        @Override\n        public void onSuccess(@Nullable ProgressSession&lt;InstallFailure&gt; session) {\n            if (session != null) {\n                Session.TerminalStateListener.bind(session, subscriptions)\n                        .addOnSuccessListener(...)\n                        .addOnFailureListener(...);\n                // or anything else you want to do with the session\n            }\n        }\n\n        @Override\n        public void onFailure(@NonNull Throwable t) {\n        }\n    }, MoreExecutors.directExecutor());\n}\n</code></pre>","path":["Guide","Getting Started"],"tags":[]},{"location":"guide/getting_started/#observing-progress","level":2,"title":"Observing progress","text":"<p>Install sessions provide progress updates:</p> KotlinJava <pre><code>session.progress // Flow&lt;Progress&gt;\n    .onEach { progress -&gt;\n        updateProgress(progress.progress, progress.max)\n    }\n    .launchIn(coroutineScope)\n</code></pre> <pre><code>session.addProgressListener(subscriptions, (sessionId, progress) -&gt; {\n    updateProgress(progress.getProgress(), progress.getMax());\n});\n</code></pre>","path":["Guide","Getting Started"],"tags":[]},{"location":"guide/getting_started/#error-handling","level":2,"title":"Error handling","text":"<p>Error causes are delivered as <code>Failure</code> objects through state listener or as a return value from <code>await()</code>. They're sealed hierarchies of typed errors — such as <code>InstallFailure</code> and <code>UninstallFailure</code> — and you can match on their type. For example:</p> KotlinJava <pre><code>val failure = failedResult.failure\nval error = when (failure) {\n    is InstallFailure.Aborted -&gt; \"Aborted\"\n    is InstallFailure.Blocked -&gt; \"Blocked by ${failure.otherPackageName}\"\n    is InstallFailure.Conflict -&gt; \"Conflicting with ${failure.otherPackageName}\"\n    is InstallFailure.Exceptional -&gt; failure.exception.message\n    is InstallFailure.Generic -&gt; \"Generic failure\"\n    is InstallFailure.Incompatible -&gt; \"Incompatible\"\n    is InstallFailure.Invalid -&gt; \"Invalid\"\n    is InstallFailure.Storage -&gt; \"Storage path: ${failure.storagePath}\"\n    is InstallFailure.Timeout -&gt; \"Timeout\"\n    else -&gt; \"Unknown failure\"\n}\n</code></pre> <pre><code>var error = \"\";\nif (failure instanceof InstallFailure.Aborted) {\n    error = \"Aborted\";\n} else if (failure instanceof InstallFailure.Blocked f) {\n    error = \"Blocked by \" + f.getOtherPackageName();\n} else if (failure instanceof InstallFailure.Conflict f) {\n    error = \"Conflicting with \" + f.getOtherPackageName();\n} else if (failure instanceof InstallFailure.Exceptional f) {\n    error = f.getException().getMessage();\n} else if (failure instanceof InstallFailure.Generic) {\n    error = \"Generic failure\";\n} else if (failure instanceof InstallFailure.Incompatible) {\n    error = \"Incompatible\";\n} else if (failure instanceof InstallFailure.Invalid) {\n    error = \"Invalid\";\n} else if (failure instanceof InstallFailure.Storage f) {\n    error = \"Storage path: \" + f.getStoragePath();\n} else if (failure instanceof InstallFailure.Timeout) {\n    error = \"Timeout\";\n} else {\n    error = \"Unknown failure\";\n}\n</code></pre> <p>When using <code>await()</code>, exceptions are never delivered as a <code>Failure.Exceptional</code> object. Instead, they are thrown.</p>","path":["Guide","Getting Started"],"tags":[]},{"location":"guide/getting_started/#testing","level":2,"title":"Testing","text":"<p>The <code>ackpine-test</code> artifact provides test doubles and utilities to drive session state and progress deterministically.</p> <p>See Testing section for details and examples, and Samples for real-world test examples.</p> <p>Every example on this page is using <code>PackageInstaller</code>, but APIs for <code>PackageUninstaller</code> are absolutely the same except for progress updates.</p>","path":["Guide","Getting Started"],"tags":[]},{"location":"guide/samples/","level":1,"title":"Samples","text":"<p>Sample apps showcasing the usage of Ackpine can be found in the GitHub repository. Each sample demonstrates different aspects of the library and serves as a reference for common integration patterns.</p>","path":["Guide","Samples"],"tags":[]},{"location":"guide/samples/#feature-matrix","level":2,"title":"Feature matrix","text":"Feature sample-java sample-ktx sample-api34 Language Java Kotlin Kotlin Async work Guava's <code>ListenableFuture</code> + <code>LiveData</code> Coroutines + <code>Flow</code> Coroutines + <code>Flow</code> Install from APK ✅ ✅ ✅ (direct streaming from web) Install from zipped splits ✅ ✅ ❌ Uninstall apps ✅ ✅ ❌ Progress tracking ✅ ✅ ✅ Process death handling ✅ ✅ ✅ Preapproval (API 34+) ❌ ❌ ✅ Install constraints (API 34+) ❌ ❌ ✅ Unit tests with <code>ackpine-test</code> ✅ ✅ ✅","path":["Guide","Samples"],"tags":[]},{"location":"guide/samples/#sample-java","level":3,"title":"<code>sample-java</code>","text":"<p>Fully written in Java. Demonstrates the callback-based API with <code>Session.TerminalStateListener</code> and <code>DisposableSubscriptionContainer</code> for lifecycle management.</p>","path":["Guide","Samples"],"tags":[]},{"location":"guide/samples/#sample-ktx","level":3,"title":"<code>sample-ktx</code>","text":"<p>Leverages the <code>ackpine-ktx</code> artifact with Kotlin coroutines and DSL APIs. Uses <code>Session.await()</code> for session lifecycle management.</p>","path":["Guide","Samples"],"tags":[]},{"location":"guide/samples/#sample-api34","level":3,"title":"<code>sample-api34</code>","text":"<p>Showcases features supported on API level 34 and higher, such as install pre-commit preapproval and installation constraints. Installs an APK from web resource with direct streaming using OkHttp.</p>","path":["Guide","Samples"],"tags":[]},{"location":"guide/samples/#key-files-to-study","level":2,"title":"Key files to study","text":"","path":["Guide","Samples"],"tags":[]},{"location":"guide/samples/#session-management-patterns","level":3,"title":"Session management patterns","text":"<p>The ViewModel files show how to create sessions, handle state transitions, and manage process death:</p> <ul> <li><code>sample-java</code> — <code>InstallViewModel.java</code>, <code>UninstallViewModel.java</code></li> <li><code>sample-ktx</code> — <code>InstallViewModel.kt</code>, <code>UninstallViewModel.kt</code></li> <li><code>sample-api34</code> — <code>MainViewModel.kt</code></li> </ul>","path":["Guide","Samples"],"tags":[]},{"location":"guide/samples/#zipped-split-apks","level":3,"title":"Zipped split APKs","text":"<p>The Fragment files show how to read zipped split APKs:</p> <ul> <li><code>sample-java</code> — <code>InstallFragment.java</code></li> <li><code>sample-ktx</code> — <code>InstallFragment.kt</code></li> </ul>","path":["Guide","Samples"],"tags":[]},{"location":"guide/samples/#testing-patterns","level":3,"title":"Testing patterns","text":"<p>The test files demonstrate how to use <code>ackpine-test</code> for unit testing session-based logic:</p> <ul> <li><code>sample-java</code> — <code>InstallViewModelTest.java</code>, <code>UninstallViewModelTest.java</code></li> <li><code>sample-ktx</code> — <code>InstallViewModelTest.kt</code>, <code>UninstallViewModelTest.kt</code></li> <li><code>sample-api34</code> — <code>MainViewModelTest.kt</code></li> </ul>","path":["Guide","Samples"],"tags":[]},{"location":"guide/shizuku/","level":1,"title":"Shizuku","text":"<p><code>ackpine-shizuku</code> artifact provides plugins for Ackpine which, when applied, use Shizuku to obtain package installer service instead of plain <code>context.getPackageManager().getPackageInstaller()</code>, so that Ackpine can manage sessions on behalf of root user or ADB shell even if your app doesn't have such privileges. This enables possibility of using such flags as bypassing low target SDK of the installed app on Android 14+, requesting version downgrade, keeping app data when uninstalling and others. Also it can bypass requirement for user's confirmation for uninstalls and fresh installs.</p> <p>Kotlin examples below use APIs from <code>ackpine-shizuku-ktx</code> artifact. For general plugin usage in session parameters, see Configuration.</p>","path":["Guide","Shizuku"],"tags":[]},{"location":"guide/shizuku/#setting-up-shizuku","level":2,"title":"Setting up Shizuku","text":"<p>You can see a full guide in the Shizuku-API repository.</p> <p>Latest Shizuku-API version: </p> <p>First of all, if you don't already have Shizuku support in your app, you need to explicitly add Shizuku-API dependencies to your build:</p> Gradle version catalogbuild.gradle.kts <pre><code>[versions]\nshizuku = \"see above\"\n\n[libraries]\nshizuku-api = { module = \"dev.rikka.shizuku:api\", version.ref = \"shizuku\" }\n\n# Add this if you want to support Shizuku\nshizuku-provider = { module = \"dev.rikka.shizuku:provider\", version.ref = \"shizuku\" }\n</code></pre> <pre><code>dependencies {\n    val shizukuVersion = \"see above\"\n    implementation(\"dev.rikka.shizuku:api:$shizukuVersion\")\n\n    // Add this if you want to support Shizuku\n    implementation(\"dev.rikka.shizuku:provider:$shizukuVersion\")\n}\n</code></pre> <p>If you want to support Shizuku in addition to Sui, add <code>ShizukuProvider</code> (which comes from <code>dev.rikka.shizuku:provider</code> artifact) to your <code>AndroidManifest.xml</code>:</p> <pre><code>&lt;provider\n    android:name=\"rikka.shizuku.ShizukuProvider\"\n    android:authorities=\"${applicationId}.shizuku\"\n    android:multiprocess=\"false\"\n    android:enabled=\"true\"\n    android:exported=\"true\"\n    android:permission=\"android.permission.INTERACT_ACROSS_USERS_FULL\" /&gt;\n</code></pre> <p>Then add an <code>ackpine-shizuku</code> dependency:</p> Gradle version catalogbuild.gradle.kts <pre><code>[libraries]\nackpine-shizuku = { module = \"ru.solrudev.ackpine:ackpine-shizuku\", version.ref = \"ackpine\" }\n\n# Kotlin extensions\nackpine-shizuku-ktx = { module = \"ru.solrudev.ackpine:ackpine-shizuku-ktx\", version.ref = \"ackpine\" }\n</code></pre> <pre><code>dependencies {\n    implementation(\"ru.solrudev.ackpine:ackpine-shizuku:$ackpineVersion\")\n\n    // Kotlin extensions\n    implementation(\"ru.solrudev.ackpine:ackpine-shizuku-ktx:$ackpineVersion\")\n}\n</code></pre> <p>Attention</p> <p>Shizuku plugin for Ackpine doesn't manage Shizuku permission and binder lifecycle. You must handle these in your app to successfully use Shizuku. See the Shizuku-API guide and their demo project.</p>","path":["Guide","Shizuku"],"tags":[]},{"location":"guide/shizuku/#using-the-plugin","level":2,"title":"Using the plugin","text":"<p>To apply the plugin to an install session, just add this to your install parameters configuration:</p> KotlinJava <pre><code>val session = packageInstaller.createSession(uri) {\n    // ...some session configuration...\n    useShizuku()\n\n    // Or, if you want to configure some parameters for the plugin\n    useShizuku {\n        bypassLowTargetSdkBlock = true\n        allowTest = true\n        replaceExisting = true\n        requestDowngrade = true\n        grantAllRequestedPermissions = true\n        allUsers = true\n        installerPackageName = \"com.android.vending\"\n    }\n}\n</code></pre> <pre><code>var parameters = new InstallParameters.Builder(uri)\n        // ...some session configuration...\n        .usePlugin(ShizukuPlugin.class, ShizukuPlugin.Parameters.DEFAULT)\n        .build();\n\n// Or, if you want to configure some parameters for the plugin\nvar shizukuParameters = new ShizukuPlugin.Parameters.Builder()\n        .setBypassLowTargetSdkBlock(true)\n        .setAllowTest(true)\n        .setReplaceExisting(true)\n        .setRequestDowngrade(true)\n        .setGrantAllRequestedPermissions(true)\n        .setAllUsers(true)\n        .setInstallerPackageName(\"com.android.vending\")\n        .build();\nvar parameters = new InstallParameters.Builder(uri)\n        .usePlugin(ShizukuPlugin.class, shizukuParameters)\n        .build();\n</code></pre> <p>Also, you can use Shizuku for uninstall sessions:</p> KotlinJava <pre><code>val session = packageUninstaller.createSession(packageName) {\n    // ...some session configuration...\n    useShizuku()\n\n    // Or, if you want to configure some parameters for the plugin\n    useShizuku {\n        keepData = true\n        allUsers = true\n    }\n}\n</code></pre> <pre><code>var parameters = new UninstallParameters.Builder(packageName)\n        // ...some session configuration...\n        .usePlugin(ShizukuUninstallPlugin.class, ShizukuUninstallPlugin.Parameters.DEFAULT)\n        .build();\n\n// Or, if you want to configure some parameters for the plugin\nvar shizukuParameters = new ShizukuUninstallPlugin.Parameters.Builder()\n        .setKeepData(true)\n        .setAllUsers(true)\n        .build();\nvar parameters = new UninstallParameters.Builder(packageName)\n        .usePlugin(ShizukuUninstallPlugin.class, shizukuParameters)\n        .build();\n</code></pre> <p>Note</p> <p>Shizuku versions below 11 are not supported, and with these versions installations will fall back to normal system's <code>PackageInstaller</code>, or <code>INTENT_BASED</code> installer (if was set).</p> <p>If Shizuku service is not running, or if Shizuku permission is not granted for your app, session will fail.</p>","path":["Guide","Shizuku"],"tags":[]},{"location":"guide/shizuku/#plugin-parameters","level":2,"title":"Plugin parameters","text":"<p>By default, all flags are disabled.</p>","path":["Guide","Shizuku"],"tags":[]},{"location":"guide/shizuku/#install-flags","level":3,"title":"Install flags","text":"","path":["Guide","Shizuku"],"tags":[]},{"location":"guide/shizuku/#bypasslowtargetsdkblock","level":4,"title":"<code>bypassLowTargetSdkBlock</code>","text":"<p>Flag to bypass the low target SDK version block for this install.</p>","path":["Guide","Shizuku"],"tags":[]},{"location":"guide/shizuku/#allowtest","level":4,"title":"<code>allowTest</code>","text":"<p>Flag to indicate that you want to allow test packages (those that have set android:testOnly in their manifest) to be installed.</p>","path":["Guide","Shizuku"],"tags":[]},{"location":"guide/shizuku/#replaceexisting","level":4,"title":"<code>replaceExisting</code>","text":"<p>Flag to indicate that you want to replace an already installed package, if one exists.</p>","path":["Guide","Shizuku"],"tags":[]},{"location":"guide/shizuku/#requestdowngrade","level":4,"title":"<code>requestDowngrade</code>","text":"<p>Flag to indicate that an upgrade to a lower version of a package than currently installed has been requested.</p>","path":["Guide","Shizuku"],"tags":[]},{"location":"guide/shizuku/#grantallrequestedpermissions","level":4,"title":"<code>grantAllRequestedPermissions</code>","text":"<p>Flag parameter for package install to indicate that all requested permissions should be granted to the package. If <code>allUsers</code> is set the runtime permissions will be granted to all users, otherwise only to the owner.</p>","path":["Guide","Shizuku"],"tags":[]},{"location":"guide/shizuku/#allusers","level":4,"title":"<code>allUsers</code>","text":"<p>Flag to indicate that this install should immediately be visible to all users.</p>","path":["Guide","Shizuku"],"tags":[]},{"location":"guide/shizuku/#installerpackagename","level":4,"title":"<code>installerPackageName</code>","text":"<p>Installer package for the app. Empty by default, so the calling app package name will be used. Takes effect only on Android 9+.</p>","path":["Guide","Shizuku"],"tags":[]},{"location":"guide/shizuku/#uninstall-flags","level":3,"title":"Uninstall flags","text":"<p>Take effect only on Android 8.1+.</p>","path":["Guide","Shizuku"],"tags":[]},{"location":"guide/shizuku/#keepdata","level":4,"title":"<code>keepData</code>","text":"<p>Flag parameter to indicate that you don't want to delete the package's data directory.</p>","path":["Guide","Shizuku"],"tags":[]},{"location":"guide/shizuku/#allusers_1","level":4,"title":"<code>allUsers</code>","text":"<p>Flag parameter to indicate that you want the package deleted for all users.</p>","path":["Guide","Shizuku"],"tags":[]},{"location":"guide/split_apks/","level":1,"title":"Split APKs","text":"<p><code>ackpine-splits</code> artifact contains utilities for working with split APK files.</p> <p>Add it to your dependencies:</p> Gradle version catalogbuild.gradle.kts <pre><code>[libraries]\nackpine-splits = { module = \"ru.solrudev.ackpine:ackpine-splits\", version.ref = \"ackpine\" }\n\n# Kotlin extensions\nackpine-splits-ktx = { module = \"ru.solrudev.ackpine:ackpine-splits-ktx\", version.ref = \"ackpine\" }\n</code></pre> <pre><code>dependencies {\n    implementation(\"ru.solrudev.ackpine:ackpine-splits:$ackpineVersion\")\n\n    // Kotlin extensions\n    implementation(\"ru.solrudev.ackpine:ackpine-splits-ktx:$ackpineVersion\")\n}\n</code></pre>","path":["Guide","Split APKs"],"tags":[]},{"location":"guide/split_apks/#reading-zipped-splits","level":2,"title":"Reading zipped splits","text":"<p><code>ZippedApkSplits</code> class contains factory methods for lazy sequences of APK splits which are contained inside of a zipped file such as ZIP, APKS, APKM and XAPK.</p> KotlinJava <pre><code>val splits: CloseableSequence&lt;Apk&gt; = ZippedApkSplits.getApksForUri(zippedFileUri, context)\nval splitsList = splits.toList()\n</code></pre> <pre><code>CloseableSequence&lt;Apk&gt; splits = ZippedApkSplits.getApksForUri(zippedFileUri, context);\nList&lt;Apk&gt; splitsList = new ArrayList&lt;&gt;();\nfor (var iterator = splits.iterator(); iterator.hasNext(); ) {\n    var apk = iterator.next();\n    splitsList.add(apk);\n}\n</code></pre> <p>Attention</p> <p>Iteration of these sequences is blocking due to I/O operations. Don't iterate them on UI thread!</p> <p>As you can see, these sequences have a type of <code>CloseableSequence</code> which implements <code>AutoCloseable</code>. That means they can close all held resources, and effectively be cancelled externally at any moment with a <code>close()</code> call.</p> <p><code>Apk</code> has the following properties:</p> <pre><code>val uri: Uri\nval name: String\nval size: Long\nval packageName: String\nval versionCode: Long\nval description: String\n</code></pre> <p><code>Apk</code> has the following types: <code>Base</code> for base APK, <code>Feature</code> for a feature split, <code>Libs</code> for an APK split containing native libraries, <code>ScreenDensity</code> for an APK split containing graphic resources tailored to specific screen density, <code>Localization</code> for an APK split containing localized resources and <code>Other</code> for an unknown APK split. They also have their specific properties. Refer to API documentation for details.</p>","path":["Guide","Split APKs"],"tags":[]},{"location":"guide/split_apks/#working-with-splits","level":2,"title":"Working with splits","text":"","path":["Guide","Split APKs"],"tags":[]},{"location":"guide/split_apks/#sequences-transformations","level":3,"title":"Sequences transformations","text":"<p><code>ApkSplits</code> class contains utilities for transforming <code>Apk</code> sequences. In Kotlin they appear as extensions of <code>Sequence&lt;Apk&gt;</code>.</p> <p>For sequences of APKs, the following operations are available:</p> <ul> <li><code>validate()</code> operation validates a split package and throws <code>SplitPackageException</code> if it's not valid when the sequence is iterated, while also closing all opened I/O resources. This operation cooperates with cancellation if upstream sequence supports it.</li> </ul> <p>Example:</p> KotlinJava <pre><code>val splits: CloseableSequence&lt;Apk&gt; = ZippedApkSplits\n    .getApksForUri(zippedFileUri, context)\n    .validate()\nval splitsList = try {\n    splits.toList()\n} catch (exception: SplitPackageException) {\n    println(exception)\n    emptyList()\n} \n</code></pre> <pre><code>CloseableSequence&lt;Apk&gt; splits = ZippedApkSplits.getApksForUri(zippedFileUri, context);\nCloseableSequence&lt;Apk&gt; validatedSplits = ApkSplits.validate(splits);\nList&lt;Apk&gt; splitsList = new ArrayList&lt;&gt;();\ntry {\n    for (var iterator = validatedSplits.iterator(); iterator.hasNext(); ) {\n        var apk = iterator.next();\n        splitsList.add(apk);\n    }\n} catch (SplitPackageException exception) {\n    System.out.println(exception);\n    splitsList = Collections.emptyList();\n}\n</code></pre>","path":["Guide","Split APKs"],"tags":[]},{"location":"guide/split_apks/#splitpackage-api","level":3,"title":"<code>SplitPackage</code> API","text":"<p>For manipulating split packages, you can use <code>SplitPackage</code> API.</p> <p><code>ackpine-splits-ktx</code> module contains Kotlin-idiomatic extensions which are used in the examples below.</p> <p>First, you create a <code>SplitPackage.Provider</code> from a sequence of APKs, e.g. obtained from <code>ZippedApkSplits</code>:</p> KotlinJava <pre><code>val splits = sequence.toSplitPackage()\n</code></pre> <pre><code>var splits = SplitPackage.from(sequence);\n</code></pre> <p>Then you can apply different operations to it, and when you're done, materialize it into a <code>SplitPackage</code> object:</p> KotlinJava <pre><code>val sortedSplits = splits.sortedByCompatibility(context)\nval splitPackage = sortedSplits.get() // &lt;- suspending, cancellable\n// print SplitPackage entries for libs APKs\nprintln(splitPackage.libs)\n</code></pre> <pre><code>var sortedSplits = splits.sortedByCompatibility(context);\nvar splitPackageFuture = sortedSplits.getAsync(); // cancellable\n// using Guava\nFutures.addCallback(splitPackageFuture, new FutureCallback&lt;&gt;() {\n    @Override\n    public void onSuccess(@NonNull SplitPackage splitPackage) {\n        // print SplitPackage entries for libs APKs\n        System.out.println(splitPackage.getLibs());\n    }\n\n    @Override\n    public void onFailure(@NonNull Throwable t) {\n    }\n}, MoreExecutors.directExecutor());\n</code></pre> <p>The <code>get()</code> is cancellable if split package source supports cancellation (such as <code>CloseableSequence</code>).</p> <p><code>libs</code> in the previous example is a <code>List&lt;SplitPackage.Entry&lt;Apk.Libs&gt;&gt;</code>.</p> <p>Each entry in APK lists inside of <code>SplitPackage</code> (such as <code>libs</code>, <code>localization</code> etc.) has <code>isPreferred</code> and <code>apk</code> properties:</p> <ul> <li><code>isPreferred</code> — indicates whether the APK is the most preferred for the device among all splits of the same type. By default it is <code>true</code>. When an operation which checks compatibility is applied, this flag is updated accordingly;</li> <li><code>apk</code> — <code>Apk</code> object.</li> </ul> <p><code>SplitPackage</code> can be flattened to a plain list of entries by calling <code>toList()</code>. Also you can filter out all entries where <code>isPreferred=false</code> with <code>filterPreferred()</code>:</p> KotlinJava <pre><code>val splitsList = splitPackage.toList()\nval compatibleSplits = splitPackage.filterPreferred()\n</code></pre> <pre><code>var splitsList = splitPackage.toList();\nvar compatibleSplits = splitPackage.filterPreferred();\n</code></pre> <p>List of available <code>SplitPackage.Provider</code> operations:</p> <ul> <li> <p><code>sortedByCompatibility(Context)</code> operation returns a provider that gives out APK splits sorted according to their compatibility with the device. The most preferred APK splits will appear first. If exact device's screen density, ABI or locale doesn't appear in the splits, nearest matching split is chosen as a preferred one.</p> </li> <li> <p><code>filterCompatible(Context)</code> operation filters out the splits which are not the most preferred for the device. It acts the same as applying <code>sortedByCompatibility(context)</code> to the provider and calling <code>filterPreferred()</code> for the resulting <code>SplitPackage</code>.</p> </li> </ul> <p>Full example of a pipeline:</p> KotlinJava <pre><code>val splits = ZippedApkSplits.getApksForUri(zippedFileUri, context)\n    .validate()\n    .toSplitPackage()\n    .sortedByCompatibility(context)\nval sortedSplits = try {\n    splits.get()             // &lt;- suspending, cancellable\n} catch (exception: SplitPackageException) {\n    println(exception)\n    SplitPackage.empty().get()\n}\nprintln(sortedSplits.libs)   // prints SplitPackage entries for libs APKs,\n                             // ordered by their compatibility with the device\nval splitsToInstall = sortedSplits.filterPreferred()\nsortedSplits\n    .toList()\n    .filterNot { entry -&gt; entry.isPreferred }\n    .map { entry -&gt; entry.apk }\n    .forEach(::println)      // prints incompatible APKs\n</code></pre> <pre><code>Sequence&lt;Apk&gt; zippedApkSplits = ZippedApkSplits.getApksForUri(uri, context);\nSequence&lt;Apk&gt; validatedSplits = ApkSplits.validate(zippedApkSplits);\nSplitPackage.Provider splits = SplitPackage\n        .from(validatedSplits)\n        .sortedByCompatibility(context);\n// using Guava\nFutures.addCallback(splits.getAsync(), new FutureCallback&lt;&gt;() {\n    @Override\n    public void onSuccess(@NonNull SplitPackage sortedSplits) {\n        // prints SplitPackage entries for libs APKs,\n        // ordered by their compatibility with the device\n        System.out.println(sortedSplits.getLibs());\n        var splitsToInstall = sortedSplits.filterPreferred();\n        for (var entry : sortedSplits.toList()) {\n            if (!entry.isPreferred()) {\n                System.out.println(entry.getApk()); // prints incompatible APKs\n            }\n        }\n    }\n\n    @Override\n    public void onFailure(@NonNull Throwable exception) {\n        if (exception instanceof SplitPackageException) {\n            System.out.println(exception);\n        }\n    }\n}, MoreExecutors.directExecutor());\n</code></pre>","path":["Guide","Split APKs"],"tags":[]},{"location":"guide/split_apks/#creating-apk-splits-from-separate-files","level":2,"title":"Creating APK splits from separate files","text":"<p>You can parse an APK file from a <code>File</code> or <code>Uri</code> using static <code>Apk</code> factories:</p> KotlinJava <pre><code>val apkFromFile: Apk? = Apk.fromFile(file, context)\nval apkFromUri: Apk? = Apk.fromUri(uri, context, cancellationSignal)\n</code></pre> <pre><code>Apk apkFromFile = Apk.fromFile(file, context);\nApk apkFromUri = Apk.fromUri(uri, context, cancellationSignal);\n</code></pre>","path":["Guide","Split APKs"],"tags":[]},{"location":"guide/testing/","level":1,"title":"Testing","text":"<p>Ackpine provides test doubles that work without Android framework dependencies and depend only on <code>ackpine-api</code>. They are suitable for JVM unit tests and Android instrumented tests.</p>","path":["Guide","Testing"],"tags":[]},{"location":"guide/testing/#dependencies","level":2,"title":"Dependencies","text":"Gradle version catalogbuild.gradle.kts <pre><code>[libraries]\nackpine-test = { module = \"ru.solrudev.ackpine:ackpine-test\", version.ref = \"ackpine\" }\n</code></pre> <pre><code>dependencies {\n    testImplementation(\"ru.solrudev.ackpine:ackpine-test:$ackpineVersion\")\n}\n</code></pre>","path":["Guide","Testing"],"tags":[]},{"location":"guide/testing/#usage","level":2,"title":"Usage","text":"<p><code>ackpine-test</code> exposes in-memory repositories and controllable sessions:</p> <ul> <li><code>TestPackageInstaller</code> and <code>TestPackageUninstaller</code> keep sessions in memory and return <code>ImmediateFuture</code> from async accessors;</li> <li><code>TestSession</code> and <code>TestProgressSession</code> expose a <code>TestSessionController</code> for state and progress control, and support scripted transitions via <code>TestSessionScript</code>.</li> </ul> <p>State and progress listeners are invoked on the calling thread, and the current state/progress is delivered immediately when a listener is added.</p> <p>In Kotlin, <code>TestInstallSession</code> is a typealias for <code>TestProgressSession&lt;InstallFailure&gt;</code>, and <code>TestUninstallSession</code> is a typealias for <code>TestSession&lt;UninstallFailure&gt;</code>.</p>","path":["Guide","Testing"],"tags":[]},{"location":"guide/testing/#testsdkint","level":3,"title":"<code>TestSdkInt</code>","text":"<p>If your tests depend on SDK-dependent behavior, configure <code>TestSdkInt</code> from the test artifact:</p> KotlinJava <pre><code>TestSdkInt.set(30)\n</code></pre> <pre><code>TestSdkInt.set(30);\n</code></pre> <p>For the most part, <code>TestSdkInt</code> is used only when constructing session parameters to determine whether Android <code>PackageInstaller</code> API is available. Use <code>TestSdkInt.reset()</code> to restore the default value.</p> <p>If you use instrumentation/Robolectric, you can set the value to <code>Build.VERSION.SDK_INT</code> for each test.</p>","path":["Guide","Testing"],"tags":[]},{"location":"guide/testing/#uri-shim","level":3,"title":"<code>Uri</code> shim","text":"<p>If you run tests on pure JVM without Android framework (without instrumentation/Robolectric), provide a shim for <code>android.net.Uri</code> and place it under <code>android.net</code> package. Test doubles don't call any methods on the <code>Uri</code> objects, so their implementation can be simple stubs. Shim example:</p> KotlinJava <pre><code>package android.net\n\nimport java.io.File\n\nclass Uri {\n    companion object {\n        @JvmField val EMPTY: Uri = Uri()\n        @JvmStatic fun parse(uri: String): Uri = Uri()\n        @JvmStatic fun fromFile(file: File): Uri = Uri()\n    }\n}\n</code></pre> <pre><code>package android.net;\n\nimport java.io.File;\n\npublic class Uri {\n    public static final Uri EMPTY = new Uri();\n    public static Uri parse(String uri) { return new Uri(); }\n    public static Uri fromFile(File file) { return new Uri(); }\n}\n</code></pre> <p>You can add any <code>Uri</code> methods you use in your code.</p>","path":["Guide","Testing"],"tags":[]},{"location":"guide/testing/#static-getinstance-methods","level":3,"title":"Static <code>getInstance()</code> methods","text":"<p>To accommodate testing, it's recommended not to use static <code>getInstance()</code> methods to get <code>PackageInstaller</code> and <code>PackageUninstaller</code> instances inside of your logic. Instead, inject them into constructors.</p> <p>Even if you don't inject <code>PackageInstaller</code> and <code>PackageUninstaller</code> interfaces into your SUT (system under test) properly, their static <code>getInstance()</code> methods will return singleton test doubles when used in tests.</p> <p>To get these singletons, call <code>PackageInstaller.getInstance()</code> or <code>PackageUninstaller.getInstance()</code> and cast them to <code>TestPackageInstaller</code> / <code>TestPackageUninstaller</code>, however, these methods require you to provide <code>Context</code>. You can create a shim for <code>Context</code> like for <code>Uri</code> if you run pure JVM tests.</p> <p>Note</p> <p>If in your tests you rely on <code>getInstance()</code> returning a test double, make sure to clear its sessions before every test by calling <code>TestPackageInstaller.clearSessions()</code> / <code>TestPackageUninstaller.clearSessions()</code>. However, it's highly recommended just to inject a dependency into SUT to immensely simplify test setup.</p>","path":["Guide","Testing"],"tags":[]},{"location":"guide/testing/#session-scripting-and-factories","level":3,"title":"Session scripting and factories","text":"<p><code>ackpine-test</code> provides <code>TestSessionScript</code> to drive scripted transitions on session's <code>launch</code>, <code>commit</code>, and <code>cancel</code> calls.</p> <p>Use <code>TestSessionScript.auto(terminalState)</code> to auto-advance through the standard states until the provided terminal state is reached, or <code>TestSessionScript.empty()</code> when you want to script state transitions manually or drive transitions directly via <code>TestSessionController</code>.</p> <p>Then create a <code>TestPackageInstaller</code> or <code>TestPackageUninstaller</code> with the script which will be applied to all created sessions:</p> KotlinJava <pre><code>val failure = Session.State.Failed(InstallFailure.Generic(\"Failure\"))\nval script: TestSessionScript&lt;InstallFailure&gt; = TestSessionScript.auto(failure)\nval installer = TestPackageInstaller(script)\n\n// Manual scripting\nval script: TestSessionScript&lt;InstallFailure&gt; = TestSessionScript.empty()\n    .onLaunch(Session.State.Awaiting)\n    .onCommit(Session.State.Succeeded)\nval installer = TestPackageInstaller(script)\n\n// State transitions through TestSessionController\nval installer = TestPackageInstaller(TestSessionScript.empty())\nsut.createSession()\nval session = installer.sessions.last()\nsession.controller.setState(Session.State.Awaiting)\nsession.controller.succeed()\n</code></pre> <pre><code>var failure = new Session.State.Failed&lt;&gt;(new InstallFailure.Generic(\"Failure\"));\nTestSessionScript&lt;InstallFailure&gt; script = TestSessionScript.auto(failure);\nvar installer = new TestPackageInstaller(script);\n\n// Manual scripting\nTestSessionScript&lt;InstallFailure&gt; script = TestSessionScript.empty()\n    .onLaunch(Session.State.Awaiting.INSTANCE)\n    .onCommit(Session.State.Succeeded.INSTANCE);\nvar installer = new TestPackageInstaller(script);\n\n// State transitions through TestSessionController\nvar installer = new TestPackageInstaller(TestSessionScript.empty());\nsut.createSession();\nvar session = installer.getSessions().getLast();\nsession.getController().setState(Session.State.Awaiting.INSTANCE);\nsession.getController().succeed();\n</code></pre> <p>If you don't provide any script, by default all sessions will auto-advance their state and complete successfully.</p> <p>You can also provide a session factory to the repository to intercept created sessions, or configure them depending on session's parameters or with different scripts. Simple example:</p> KotlinJava <pre><code>val sessions = mutableListOf&lt;TestInstallSession&gt;()\nval installer = TestPackageInstaller { sessionId, params -&gt;\n    TestInstallSession(TestSessionScript.empty(), sessionId).also(sessions::add)\n}\n\n// when your SUT creates a session, it becomes available here\nval session = sessions.last()\nsession.controller.succeed()\n</code></pre> <pre><code>var sessions = new ArrayList&lt;TestProgressSession&lt;InstallFailure&gt;&gt;();\nvar installer = new TestPackageInstaller((sessionId, params) -&gt; {\n    var session = new TestProgressSession&lt;InstallFailure&gt;(TestSessionScript.empty(), sessionId);\n    sessions.add(session);\n    return session;\n});\n\n// when your SUT creates a session, it becomes available here\nvar session = sessions.getLast();\nsession.getController().succeed();\n</code></pre>","path":["Guide","Testing"],"tags":[]},{"location":"guide/testing/#conceptual-example","level":3,"title":"Conceptual example","text":"KotlinJava <pre><code>val script = TestSessionScript.empty&lt;InstallFailure&gt;()\n    .onLaunch(Session.State.Awaiting)\n    .onCommit(Session.State.Succeeded)\nval installer = TestPackageInstaller(script)\n// or with a custom factory\nval installerWithFactory = TestPackageInstaller { id, params -&gt;\n    TestInstallSession(script, id)\n}\nval uri = Uri.EMPTY // shim\ninstaller.createSession(uri)\nval session = installer.sessions.last()\nval progress = Progress(progress = 80, max = 100)\nsession.controller.setProgress(progress)\nval result = session.await()\nassertIs&lt;Session.State.Succeeded&gt;(result)\nassertEquals(progress, session.progress)\n</code></pre> <pre><code>TestSessionScript&lt;InstallFailure&gt; script = TestSessionScript.empty()\n        .onLaunch(Session.State.Awaiting.INSTANCE)\n        .onCommit(Session.State.Succeeded.INSTANCE);\nvar installer = new TestPackageInstaller(script);\n// or with a custom factory\nvar installerWithFactory = new TestPackageInstaller((id, params) -&gt;\n        new TestProgressSession&lt;&gt;(script, id));\nvar uri = Uri.EMPTY; // shim\ninstaller.createSession(new InstallParameters.Builder(uri).build());\nvar session = installer.getSessions().getLast();\nvar progress = new Progress(80, 100);\nsession.getController().setProgress(progress);\n// using SettableFuture from Guava\nvar future = SettableFuture.&lt;Session.State.Completed&lt;InstallFailure&gt;&gt;create();\nvar subscriptions = new DisposableSubscriptionContainer();\nSession.TerminalStateListener.bind(session, subscriptions)\n        .addOnSuccessListener(sessionId -&gt; future.set(Session.State.Succeeded.INSTANCE))\n        .addOnFailureListener((sessionId, failure) -&gt; future.set(new Session.State.Failed&lt;&gt;(failure)));\nvar result = future.get();\nassertTrue(result instanceof Session.State.Succeeded);\nassertEquals(progress, session.getProgress());\n</code></pre> <p>Use <code>ImmediateFuture</code> when you need a completed <code>ListenableFuture</code> for tests. For example, when using <code>SplitPackage</code> API from <code>ackpine-splits</code>:</p> KotlinJava <pre><code>val provider = SplitPackage.Provider { ImmediateFuture.success(splitPackage) }\nval failingProvider = SplitPackage.Provider { ImmediateFuture.failure(Exception(\"Failure\")) }\n</code></pre> <pre><code>SplitPackage.Provider provider = () -&gt; ImmediateFuture.success(splitPackage);\nSplitPackage.Provider failingProvider = () -&gt; ImmediateFuture.failure(new Exception(\"Failure\"));\n</code></pre> <p>If you need deterministic session IDs or want to seed sessions into the repositories:</p> KotlinJava <pre><code>val uninstaller = TestPackageUninstaller()\nval sessionId = UUID.fromString(\"00000000-0000-4000-8000-000000000000\")\nval session = TestUninstallSession(id = sessionId)\nuninstaller.seedSession(session)\n</code></pre> <pre><code>var uninstaller = new TestPackageUninstaller();\nvar sessionId = UUID.fromString(\"00000000-0000-4000-8000-000000000000\");\nvar session = new TestSession&lt;UninstallFailure&gt;(\n        TestSessionScript.auto(Session.State.Succeeded.INSTANCE),\n        sessionId\n);\nuninstaller.seedSession(session);\n</code></pre> <p>For real and more thorough examples, see Samples.</p>","path":["Guide","Testing"],"tags":[]}]}